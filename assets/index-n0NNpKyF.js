!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e=[{id:1,y:40.8,x:51.4,lat:49.7597,lng:16.6647,title:"Moravská Třebová",description:"Domov L. V. Holzmaistera a sídlo muzea, kam zasílal své sbírky.",image:"/assets/images/item_24.jpg",region:"Europe",visitDate:"1885"},{id:2,y:47.3,x:55.5,lat:31.2001,lng:29.9187,title:"Egypt - Alexandrie",description:"Starověký přístav. Získání koptských textilií.",image:"/assets/images/item_18.jpg",region:"North Africa",visitDate:"1891"},{id:3,y:47.3,x:56.9,lat:30.0444,lng:31.2357,title:"Egypt - Káhira",description:"Centrum obchodu na Blízkém východě. Nákup starožitností na trhu Chán al-Chalílí.",image:"/assets/images/item_17.jpg",region:"North Africa",visitDate:"1891"},{id:4,y:48.9,x:57.7,lat:29.9668,lng:32.5498,title:"Egypt - Suez",description:"Průjezd Suezským průplavem, klíčovým bodem cesty na východ.",image:"/assets/images/item_19.jpg",region:"North Africa",visitDate:"1891"},{id:5,y:52,x:62,lat:12.8654,lng:45.0187,title:"Jemen - Aden",description:"Důležitá zastávka pro doplnění uhlí. Nákup aromatických pryskyřic.",image:"/assets/images/item_20.jpg",region:"Middle East",visitDate:"1891"},{id:6,y:54.2,x:70.1,lat:6.9271,lng:79.8612,title:"Srí Lanka - Kolombo",description:"Zastávka na cestě do Asie. Nákup drahokamů a tradičních masek.",image:"/assets/images/item_7.jpg",region:"South Asia",visitDate:"1891"},{id:7,y:56.9,x:75.6,lat:1.3521,lng:103.8198,title:"Singapur",description:"Křižovatka obchodních cest. Zde se Holzmaister setkal s obchodníky z celého světa.",image:"/assets/images/item_12.jpg",region:"South East Asia",visitDate:"1891"},{id:8,y:58.3,x:77.2,lat:-6.2088,lng:106.8456,title:"Indonésie - Batávie (Jakarta)",description:"Nizozemská východní Indie. Sběr krisů (tradičních dýk) a batikovaných látek.",image:"/assets/images/item_11.jpg",region:"South East Asia",visitDate:"1891"},{id:9,y:54.4,x:74.9,lat:13.7563,lng:100.5018,title:"Thajsko - Bangkok",description:"Království Siam. Návštěva chrámů a získání sošky Buddhy.",image:"/assets/images/item_13.jpg",region:"South East Asia",visitDate:"1892"},{id:10,y:51.7,x:68.2,lat:19.076,lng:72.8777,title:"Indie - Bombaj",description:"Vstupní brána do Indie. Fascinace rušnými trhy a architekturou viktoriánské gotiky.",image:"/assets/images/item_8.jpg",region:"South Asia",visitDate:"1892"},{id:11,y:48.9,x:68,lat:28.7041,lng:77.1025,title:"Indie - Dillí",description:"Návštěva Červené pevnosti a získání mogulskejch miniatur.",image:"/assets/images/item_9.jpg",region:"South Asia",visitDate:"1892"},{id:12,y:50.1,x:70.7,lat:25.3176,lng:82.9739,title:"Indie - Váránasí",description:"Posvátné město na Ganze. Pozorování rituálů a nákup rituálních nádob.",image:"/assets/images/item_10.jpg",region:"South Asia",visitDate:"1892"},{id:13,y:48.8,x:79.4,lat:31.2304,lng:121.4737,title:"Čína - Šanghaj",description:"Rušný přístav a brána do Číny. Sbírka obsahuje porcelánové vázy z dynastie Čching zakoupené na nábřeží Bund.",image:"/assets/images/item_4.jpg",region:"East Asia",visitDate:"1892"},{id:14,y:51.9,x:76.6,lat:22.3193,lng:114.1694,title:"Čína - Hongkong",description:"Britská kolonie v době návštěvy. Holzmaistera fascinovala směs východní a západní architektury.",image:"/assets/images/item_5.jpg",region:"East Asia",visitDate:"1892"},{id:15,y:47.2,x:78.3,lat:39.9042,lng:116.4074,title:"Čína - Peking",description:"Návštěva Zakázaného města. Získání tradičního hedvábného oděvu pro muzeum.",image:"https://images.unsplash.com/photo-1508804185872-d7badad00f7d?auto=format&fit=crop&q=80&w=800",region:"East Asia",visitDate:"1892"},{id:16,y:44.5,x:85.3,lat:35.4437,lng:139.638,title:"Japonsko - Jokohama",description:"Hlavní přístav, kterým Holzmaister připlul do Japonska. Zde zakoupil 'Japonské album' s ručně kolorovanými fotografiemi.",image:"/assets/images/item_3.jpg",region:"East Asia",visitDate:"1893"},{id:17,y:46.2,x:84.5,lat:35.6762,lng:139.6503,title:"Japonsko - Tokio",description:"Císařské město, kde Holzmaister strávil několik týdnů. Zde získal vzácné lakované krabičky a samurajské doplňky.",image:"/assets/images/item_1.jpg",region:"East Asia",visitDate:"1893"},{id:18,y:45.3,x:83.9,lat:35.0116,lng:135.7681,title:"Japonsko - Kjóto",description:"Starobylé hlavní město. Fotografie zachycuje chrám Kinkaku-dži, který Holzmaister navštívil během období kvetoucích sakur.",image:"/assets/images/item_2.jpg",region:"East Asia",visitDate:"1893"},{id:19,y:61.2,x:95.1,lat:-17.7134,lng:178.065,title:"Fidži",description:"Exotická zastávka v Pacifiku. Ukázky domorodého umění.",image:"/assets/images/item_25.jpg",region:"Oceania",visitDate:"1893"},{id:20,y:68.1,x:94.1,lat:-36.8485,lng:174.7633,title:"Nový Zéland - Auckland",description:"Setkání s Maorskou kulturou. Do sbírky přibyly řezby ze dřeva a nefritu.",image:"/assets/images/item_16.jpg",region:"Oceania",visitDate:"1893"},{id:21,y:65.1,x:88.2,lat:-33.8688,lng:151.2093,title:"Austrálie - Sydney",description:"Přístavní město v Oceánii. Získání domorodých artefaktů a bumerangů.",image:"/assets/images/item_14.jpg",region:"Australia",visitDate:"1893"},{id:22,y:67.6,x:86.8,lat:-37.8136,lng:144.9631,title:"Austrálie - Melbourne",description:"Bohaté město díky zlaté horečce. Návštěva botanických zahrad.",image:"/assets/images/item_15.jpg",region:"Australia",visitDate:"1893"},{id:23,y:46.4,x:58.4,lat:31.7683,lng:35.2137,title:"Jeruzalém",description:"Svaté město. Získání upomínkových předmětů z olivového dřeva.",image:"/assets/images/item_21.jpg",region:"Middle East",visitDate:"1894"},{id:24,y:45.1,x:58.7,lat:33.5138,lng:36.2765,title:"Damašek",description:"Jedno z nejstarších měst. Obdivování damašské oceli a látek.",image:"/assets/images/item_22.jpg",region:"Middle East",visitDate:"1894"},{id:25,y:44.8,x:28.2,lat:40.7128,lng:-74.006,title:"New York",description:"Dlouhodobé působení Holzmaistera v USA, odkud podporoval muzeum.",image:"/assets/images/item_23.jpg",region:"North America",visitDate:"1895-1920"}],t="antigravity_gem_hints",n="antigravity_revealed_gems";function i(e=25){let n=a();return n&&0!==Object.keys(n).length||(n=function(e){const t={},n=[1,2,3,4,5],i=Array.from({length:e},(e,t)=>t+1),a=i.sort(()=>Math.random()-.5);return a.slice(0,5).forEach((e,i)=>{t[e]=n[i]}),t}(e),function(e){try{localStorage.setItem(t,JSON.stringify(e))}catch(n){console.error("Error saving gem hints:",n)}}(n)),n}function a(){try{const e=localStorage.getItem(t);return e?JSON.parse(e):{}}catch(e){return console.error("Error loading gem hints:",e),{}}}function s(){try{const e=localStorage.getItem(n);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading revealed gems:",e),[]}}function o(e,t){const i=s(),a=t.filter(t=>t.type===e).map(e=>e.id),o=[...new Set([...i,...a])];return function(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(t){console.error("Error saving revealed gems:",t)}}(o),o}function l(e){return s().includes(e)}const r=[{id:1,x:15.5,y:23.2,code:"TRA-1888",type:1,revealed:!1},{id:2,x:45.3,y:12.8,code:"TRA-3421",type:1,revealed:!1},{id:3,x:72.1,y:65.4,code:"TRA-5692",type:1,revealed:!1},{id:4,x:45.8,y:67.3,code:"MOR-2341",type:2,revealed:!1},{id:5,x:18.6,y:54.7,code:"MOR-7823",type:2,revealed:!1},{id:6,x:83.2,y:28.9,code:"MOR-4156",type:2,revealed:!1},{id:7,x:78.2,y:34.6,code:"JAP-5729",type:3,revealed:!1},{id:8,x:32.4,y:78.1,code:"JAP-9184",type:3,revealed:!1},{id:9,x:56.7,y:19.3,code:"JAP-2637",type:3,revealed:!1},{id:10,x:62.1,y:52.8,code:"IND-8432",type:4,revealed:!1},{id:11,x:24.8,y:38.5,code:"IND-1947",type:4,revealed:!1},{id:12,x:91.3,y:71.2,code:"IND-5281",type:4,revealed:!1},{id:13,x:88.7,y:71.4,code:"AUS-3156",type:5,revealed:!1},{id:14,x:12.9,y:58.6,code:"AUS-7429",type:5,revealed:!1},{id:15,x:67.5,y:43.9,code:"AUS-8163",type:5,revealed:!1}];let c,d,u=null;function m(e,t,n=[],i=null){p();const s=document.createElement("div");s.classList.add("modal-overlay");const c=n.findIndex(t=>t.id===e.id),d=(c-1+n.length)%n.length,m=(c+1)%n.length,v=(g=e.id,a()[g]||null);var g;let h="";if(v){const e=r.some(e=>e.type===v&&l(e.id));h=`\n        <div class="gem-hint-bar">\n            <div class="gem-hint-content">\n                <img src="/assets/gems/gem_0${v}.png" alt="Gem Hint" class="gem-hint-icon">\n                <div class="gem-hint-text">\n                    <strong>Hidden Gem Detected!</strong>\n                    <span>This location holds a clue to finding rare crystals.</span>\n                </div>\n                <button class="${e?"gem-reveal-btn disabled":"gem-reveal-btn"}" data-gem-type="${v}" ${e?"disabled":""}>\n                    ${e?"Gems Revealed!":"Unhide Gems on Map"}\n                </button>\n            </div>\n        </div>\n      `}s.innerHTML=`\n    <div class="modal-content">\n      <div class="modal-image-container">\n        ${h}\n        <img src="${e.image}" alt="${e.title}" class="modal-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">\n        <div class="modal-image-placeholder" style="display: none;">\n            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="1">\n                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n                <circle cx="8.5" cy="8.5" r="1.5"/>\n                <polyline points="21 15 16 10 5 21"/>\n            </svg>\n            <span>Chybí fotografie</span>\n        </div>\n        <div class="modal-region-tag">${e.region}</div>\n      </div>\n      <div class="modal-info">\n        <button class="close-button">\n            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">\n                <line x1="18" y1="6" x2="6" y2="18"></line>\n                <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n        </button>\n        <div class="modal-location-label">\n            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                <circle cx="12" cy="10" r="3"></circle>\n            </svg>\n            LOKACE Č. ${e.id}\n        </div>\n        <h2 class="modal-title">${e.title}</h2>\n        ${e.visitDate?`<div class="modal-visit-date">Navštíveno: ${e.visitDate}</div>`:""}\n        <div class="modal-divider"></div>\n        <p class="modal-description">${e.description}</p>\n        \n        <div class="modal-nav-buttons">\n            <button class="nav-btn prev-btn">\n                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">\n                    <polyline points="15 18 9 12 15 6"></polyline>\n                </svg>\n                Předchozí\n            </button>\n            <button class="nav-btn next-btn">\n                Další\n                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">\n                    <polyline points="9 18 15 12 9 6"></polyline>\n                </svg>\n            </button>\n        </div>\n\n        <div class="modal-footer">Sbírka L. V. Holzmaistera</div>\n      </div>\n    </div>\n    `,t.appendChild(s),requestAnimationFrame(()=>{s.classList.add("active")});s.querySelector(".close-button").addEventListener("click",p),s.addEventListener("click",e=>{e.target===s&&p()});const y=s.querySelector(".gem-reveal-btn");y&&!y.classList.contains("disabled")&&y.addEventListener("click",e=>{e.stopPropagation();const t=parseInt(y.dataset.gemType);o(t,r),y.textContent="Gems Revealed!",y.classList.add("disabled"),y.disabled=!0,window.dispatchEvent(new CustomEvent("gemRevealed",{detail:{gemType:t}}))}),i&&(s.querySelector(".prev-btn").addEventListener("click",()=>{s.classList.remove("active"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),u=null,i(d)},3e3)}),s.querySelector(".next-btn").addEventListener("click",()=>{s.classList.remove("active"),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),u=null,i(m)},3e3)})),u=s}function p(){if(u){const e=u;e.classList.remove("active"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},3e3),u=null}}class v{constructor(e){this.onStart=e,this.overlay=null,this.init()}init(){this.overlay=document.createElement("div"),this.overlay.classList.add("idle-screen-overlay"),this.overlay.innerHTML='\n            <div class="start-game-container">\n                <img src="/assets/start_jorney.png" class="start-game-bg" alt="Start Journey">\n                <button class="start-game-btn">\n                    <img src="/assets/start_button.png" alt="Start Game">\n                </button>\n            </div>\n        ',this.overlay.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.4);\n            backdrop-filter: blur(8px);\n            -webkit-backdrop-filter: blur(8px);\n            z-index: 999999;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            opacity: 0;\n            pointer-events: none;\n            transition: opacity 0.5s ease;\n        ",document.body.appendChild(this.overlay);const e=this.overlay.querySelector(".start-game-btn");e&&e.addEventListener("click",e=>{e.stopPropagation(),this.hide(),this.onStart&&this.onStart()})}show(){this.overlay&&(console.log("Showing Start Page"),this.overlay.style.opacity="1",this.overlay.style.pointerEvents="auto",setTimeout(()=>{window.dispatchEvent(new CustomEvent("gameReset"))},100))}hide(){this.overlay&&(console.log("Hiding Start Page"),this.overlay.style.opacity="0",this.overlay.style.pointerEvents="none")}}let g=null;function h(){console.log("=== IDLE TIMER INIT START ==="),g=new v(()=>{console.log("Start Game clicked - starting idle tracking"),function(){console.log("Starting idle tracking..."),y();["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(e=>{document.addEventListener(e,y,{passive:!0})})}()}),console.log("Initializing IdleTimer - Showing Start Page"),requestAnimationFrame(()=>{g.show(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("gameReset"))},100)}),console.log("=== IDLE TIMER INIT END ===")}function y(){clearTimeout(c),clearTimeout(d),d=setTimeout(f,6e4),c=setTimeout(b,12e4)}function f(){console.log("1 minute idle - resetting zoom..."),window.dispatchEvent(new CustomEvent("zoomReset"))}function b(){console.log("2 minutes idle - showing Start Game page..."),p(),g&&g.show(),window.dispatchEvent(new CustomEvent("gameReset"))}let x=null;function k(){if(x){const e=x;e.classList.remove("active"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500),x=null}}function E(a,s){let o=1,c=0,d=0,u=!1,p=!1,v=null,g=[...e],h=[...r],f=!1,b={x:0,y:0},E=0,S=0,L=1,w=1,M=.5,q=!1,C=0,j=0,A=0,z=0;i(e.length);const D=document.createElement("div");D.classList.add("map-content-wrapper"),a.appendChild(D);const T=document.createElement("div");T.classList.add("map-background-container");const _=[{src:"/assets/WorldMap_bg_1k.jpg",res:"1k",element:null},{src:"/assets/WorldMap_bg_2k.jpg",res:"2k",element:null},{src:"/assets/WorldMap_bg_4k.jpg",res:"4k",element:null},{src:"/assets/WorldMap_bg_8k.jpg",res:"8k",element:null}];_.forEach((e,t)=>{const n=document.createElement("img");n.src=e.src,n.classList.add("map-layer"),n.dataset.res=e.res,0===t?n.classList.add("base-layer"):n.classList.add("overlay-layer"),n.ondragstart=e=>e.preventDefault(),T.appendChild(n),e.element=n});const $=document.createElement("div");$.classList.add("tiles-16k-container"),$.style.cssText="\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        grid-template-rows: 1fr 1fr;\n        opacity: 0;\n        transition: opacity 0.5s ease-in-out;\n        z-index: 2;\n    ",[{src:"/assets/16k_aa.jpg",position:"top-left",element:null},{src:"/assets/16k_ab.jpg",position:"top-right",element:null},{src:"/assets/16k_ba.jpg",position:"bottom-left",element:null},{src:"/assets/16k_bb.jpg",position:"bottom-right",element:null}].forEach(e=>{const t=document.createElement("img");t.src=e.src,t.style.cssText="width: 100%; height: 100%; display: block; object-fit: cover;",t.ondragstart=e=>e.preventDefault(),$.appendChild(t),e.element=t}),T.appendChild($),D.appendChild(T);let N=0,I=0,F=!1,R=!1,H=null;function P(){let e=0,t=!1;return o<=1?e=0:o<=2?e=1:o<=4?e=2:o<=8?e=3:(e=3,t=!0),e===I&&t===R||(I=e,R=t,clearTimeout(H),H=setTimeout(()=>{!function(e,t=!1){N=e,F=t,_.forEach((n,i)=>{i<=e?i>0&&(t&&3===i?n.element.classList.remove("active"):n.element.classList.add("active")):n.element.classList.remove("active")}),$.style.opacity=t?"1":"0";const n=t?B():_[N].src.split("/").pop();ce(n)}(e,t)},300)),F?B():_[N].src.split("/").pop()}function B(){const e=a.getBoundingClientRect(),t=e.width/2,n=(e.height/2-J)/Y,i=(t-O)/Y/D.offsetWidth*100;let s="";return s=n/D.offsetHeight*100<50?i<50?"16k_aa.jpg":"16k_ab.jpg":i<50?"16k_ba.jpg":"16k_bb.jpg",s}let Y=1,O=0,J=0,X=1,G=0,Z=0;const W=16;let U,K=null;function V(){clearTimeout(U),U=setTimeout(()=>{const e=Q();X=e,G=0,Z=0,se()},6e4)}function Q(){a.offsetWidth;const e=a.offsetHeight;D.offsetWidth;const t=D.offsetHeight||e;return 0===t?1:Math.max(1,e/t)}V();let ee=null;function te(e,t=!0){if(e<0||e>=g.length)return;const n=g[e];D.querySelectorAll(".map-point").forEach(e=>e.classList.remove("active"));const i=D.querySelector(`.map-point[data-id="${n.id}"]`);i&&i.classList.add("active");const o=a.getBoundingClientRect(),l=o.width/2,r=o.height/2,c=D.offsetWidth,d=D.offsetHeight,u=n.x/100*c,p=n.y/100*d;if(t){let e=2*X;e<2&&(e=2),e>W&&(e=W),X=e,ee=e}else ee&&(X=ee);G=l-u*X,Z=r-p*X,se(),K=()=>{m(n,s,g,e=>{te(e,!1)}),y(),V()}}function ne(){D.querySelectorAll(".map-point").forEach(e=>e.remove()),g.forEach((e,t)=>{const n=document.createElement("div");n.classList.add("map-point"),u&&n.classList.add("draggable"),n.style.left=`${e.x}%`,n.style.top=`${e.y}%`,n.dataset.id=e.id;const i=document.createElement("div");i.classList.add("map-point-label"),i.textContent=e.title,n.appendChild(i);const a=e=>{u||(e.stopPropagation(),y(),V(),te(t))};n.addEventListener("click",a),n.addEventListener("touchstart",e=>{u||a(e)},{passive:!0}),n.addEventListener("mousedown",t=>{u&&(t.stopPropagation(),p=!0,v=e.id,n.classList.add("dragging"))}),D.appendChild(n)})}function ie(){D.querySelectorAll(".gem-point").forEach(e=>e.remove()),h.forEach(e=>{const t=document.createElement("div");t.classList.add("gem-point"),t.style.left=`${e.x}%`,t.style.top=`${e.y}%`,t.dataset.id=e.id;const n=e.type||e.id%5+1;t.style.backgroundImage=`url('/assets/gems/gem_0${n}.png')`,t.addEventListener("click",t=>{u||f||(t.stopPropagation(),function(e,t){k();const n=document.createElement("div");n.classList.add("gem-modal-overlay");const i=`/assets/gems/gem_0${e.type||e.id%5+1}.png`;n.innerHTML=`\n        <div class="gem-modal-content">\n            <div class="gem-modal-icon">\n                <img src="${i}" alt="Gem" style="width: 80px; height: 80px; object-fit: contain;">\n            </div>\n            <h2 class="gem-modal-title">Hidden Artifact Found!</h2>\n            <p class="gem-modal-subtitle">You have discovered a secret location.</p>\n            <div class="gem-modal-code-label">SECRET CODE</div>\n            <div class="gem-modal-code">${e.code}</div>\n            <button class="gem-modal-close">Close</button>\n        </div>\n    `,t.appendChild(n),requestAnimationFrame(()=>{n.classList.add("active")}),n.querySelector(".gem-modal-close").addEventListener("click",k),n.addEventListener("click",e=>{e.target===n&&k()}),x=n}(e,s),y(),V())}),D.appendChild(t)}),ae()}function ae(){D.querySelectorAll(".gem-point").forEach(e=>{const t=l(parseInt(e.dataset.id));Y>=8||t?(e.classList.add("visible"),t&&Y<8?e.classList.add("revealed-low-zoom"):e.classList.remove("revealed-low-zoom")):(e.classList.remove("visible"),e.classList.remove("revealed-low-zoom"))})}function se(){const e=a.offsetWidth,t=a.offsetHeight,n=D.offsetWidth,i=D.offsetHeight,s=Q();X<s&&(X=s),X>W&&(X=W);const o=e-n*X,l=t-i*X;G=Math.min(Math.max(G,o),0),Z=Math.min(Math.max(Z,l),0)}ne(),window.addEventListener("gemRevealed",()=>{ae()}),window.addEventListener("zoomReset",()=>{console.log("Zoom resetting to initial view...");const e=Q();X=e,G=0,Z=0,se()}),window.addEventListener("gameReset",()=>{console.log("Game Resetting..."),localStorage.removeItem(t),localStorage.removeItem(n);const a=[];for(let e=1;e<=5;e++)for(let t=0;t<3;t++)a.push(e);for(let e=a.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}h.forEach((e,t)=>{t<a.length&&(e.type=a[t])}),i(e.length),ie();const s=Q();X=s,G=0,Z=0,se()}),ie();let oe=null,le={version:"...",prompts:0,timeSpentMinutes:0};function re(e){return`${Math.floor(e/60)}h ${e%60}m`}function ce(e){if(!oe)return;const t=oe.querySelector(".debug-version"),n=oe.querySelector(".debug-bg-name"),i=oe.querySelector(".debug-zoom-value"),a=oe.querySelector(".debug-x"),s=oe.querySelector(".debug-y");t&&(t.textContent=`v${le.version} | P: ${le.prompts} | T: ${re(le.timeSpentMinutes)}`),n&&(n.textContent=e),i&&(i.textContent=`${Y.toFixed(2)}x`),a&&(a.textContent=b.x.toFixed(1)),s&&(s.textContent=b.y.toFixed(1))}oe=document.createElement("div"),oe.classList.add("debug-panel"),oe.innerHTML=`\n            <div class="debug-version">v${le.version} | P: ${le.prompts} | T: ${re(le.timeSpentMinutes)}</div>\n            <div class="debug-date">${(new Date).toLocaleDateString("cs-CZ")}</div>\n            <div class="debug-bg">BG: <span class="debug-bg-name">...</span></div>\n            <div class="debug-zoom">Zoom: <span class="debug-zoom-value">1.00x</span></div>\n            <div class="debug-coords">X: <span class="debug-x">0</span>% Y: <span class="debug-y">0</span>%</div>\n        `,document.body.appendChild(oe),async function(){try{const e=await fetch("/production.json");le=await e.json(),ce(_[N].src.split("/").pop())}catch(e){console.error("Failed to load production data",e)}}(),requestAnimationFrame(function e(){const t=Math.abs(G-O),n=Math.abs(Z-J),i=Math.abs(X-Y),a=Math.sqrt(t*t+n*n)+100*i,s=Math.min(a/1e3,1);var l;const r=.05+.05*((l=1-s)<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2);O+=(G-O)*r,J+=(Z-J)*r,Y+=(X-Y)*r,Math.abs(G-O)<.5&&Math.abs(Z-J)<.5&&Math.abs(X-Y)<.005&&(O=G,J=Z,Y=X,K&&(K(),K=null)),D.style.transform=`translate(${O}px, ${J}px) scale(${Y})`,ce(P()),ae(),o=Y,c=O,d=J,requestAnimationFrame(e)}),a.addEventListener("wheel",e=>{e.preventDefault(),y(),V();const t=a.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,s=(n-G)/X,o=(i-Z)/X;-e.deltaY>0?X*=1.2:X/=1.2,se(),G=n-s*X,Z=i-o*X,se()},{passive:!1}),a.addEventListener("dblclick",e=>{e.preventDefault(),y(),V();const t=a.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;let s=2*X;s>W&&(s=W);const o=t.width/2,l=t.height/2,r=(n-G)/X,c=(i-Z)/X;X=s,G=o-r*X,Z=l-c*X,se()});let de=!1,ue=0,me=0,pe=null,ve=1;function ge(e){const t=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY;return Math.hypot(t,n)}function he(e){return{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}function ye(e){if(!u||!p)if(y(),V(),e.touches){if(1===e.touches.length)de=!0,ue=e.touches[0].clientX,me=e.touches[0].clientY,a.style.cursor="grabbing";else if(2===e.touches.length){de=!1,pe=ge(e.touches),ve=X;const t=he(e.touches);ue=t.x,me=t.y}}else de=!0,ue=e.clientX,me=e.clientY,a.style.cursor="grabbing"}function fe(e){y(),V();const t=e.clientX||(e.touches?e.touches[0].clientX:0),n=e.clientY||(e.touches?e.touches[0].clientY:0),i=a.getBoundingClientRect(),s=t-i.left,o=n-i.top,l=(s-O)/Y,r=(o-J)/Y,c=D.offsetWidth,d=D.offsetHeight;if(b.x=l/c*100,b.y=r/d*100,u&&p&&v){e.preventDefault();let t=b.x,n=b.y;t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n));const i=D.querySelector(`.map-point[data-id="${v}"]`);i&&(i.style.left=`${t}%`,i.style.top=`${n}%`);const a=g.findIndex(e=>e.id===v);-1!==a&&(g[a].x=Math.round(10*t)/10,g[a].y=Math.round(10*n)/10);const s=Ae.querySelector(".coord-x"),o=Ae.querySelector(".coord-y");return void(s&&o&&(s.textContent=t.toFixed(1),o.textContent=n.toFixed(1)))}if(e.touches&&2===e.touches.length){e.preventDefault();const t=ge(e.touches);if(pe){X=ve*(t/pe);const n=he(e.touches),i=n.x-ue,a=n.y-me;G+=i,Z+=a,ue=n.x,me=n.y,se()}}else if(de){e.preventDefault();G+=t-ue,Z+=n-me,ue=t,me=n,se()}}function be(e){if(f&&!de){if(e.clientX||e.changedTouches&&e.changedTouches[0].clientX,e.clientY||e.changedTouches&&e.changedTouches[0].clientY,e.target.closest(".edit-mode-ui")||e.target.closest(".map-point"))return;const t={id:h.length+1,x:Math.round(10*b.x)/10,y:Math.round(10*b.y)/10,code:xe()};return h.push(t),void ie()}if(de=!1,pe=null,a.style.cursor="default",p){p=!1;const e=D.querySelector(`.map-point[data-id="${v}"]`);e&&e.classList.remove("dragging"),v=null}}function xe(){const e=["TRA","MOR","JAP","IND","AUS","EGY","CHN"];return`${e[Math.floor(Math.random()*e.length)]}-${Math.floor(9e3*Math.random())+1e3}`}a.addEventListener("mousedown",ye),a.addEventListener("touchstart",ye,{passive:!1}),window.addEventListener("mousemove",fe),window.addEventListener("touchmove",fe,{passive:!1}),window.addEventListener("mouseup",be),window.addEventListener("touchend",be),window.addEventListener("resize",()=>{se()}),_[0].element&&(_[0].element.onload=()=>{se(),O=G,J=Z,Y=X});const ke=document.createElement("div");ke.classList.add("admin-trigger"),ke.innerHTML='\n        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>\n        </svg>\n    ',ke.title="Edit Mode",document.body.appendChild(ke);const Ee=document.createElement("div");Ee.classList.add("reference-overlay"),D.insertBefore(Ee,D.firstChild);const Se=document.createElement("div");Se.classList.add("ref-handle","ref-handle-top"),Se.innerHTML='<div class="handle-line"></div>',Ee.appendChild(Se);const Le=document.createElement("div");Le.classList.add("ref-handle","ref-handle-bottom"),Le.innerHTML='<div class="handle-line"></div>',Ee.appendChild(Le),Ee.addEventListener("mousedown",e=>{u&&Ee.classList.contains("active")&&(e.target.closest(".ref-handle")||(q=!0,C=e.clientX,j=e.clientY,A=E,z=S,Ee.style.cursor="grabbing",e.stopPropagation()))}),window.addEventListener("mousemove",e=>{if(q){const t=e.clientX-C,n=e.clientY-j;E=A+t,S=z+n,Ae.querySelector(".input-ref-x").value=E.toFixed(1),Ae.querySelector(".input-ref-y").value=S.toFixed(1),De()}}),window.addEventListener("mouseup",()=>{q&&(q=!1,Ee.style.cursor="grab")});let we=!1,Me=null,qe=0,Ce=1;function je(e,t){u&&Ee.classList.contains("active")&&(we=!0,Me=t,qe=e.clientY,Ce=w,e.stopPropagation(),e.preventDefault())}Se.addEventListener("mousedown",e=>je(e,"top")),Le.addEventListener("mousedown",e=>je(e,"bottom")),window.addEventListener("mousemove",e=>{if(we){const t=(e.clientY-qe)/500;if("top"===Me){w=Math.max(.1,Math.min(3,Ce-t));const e=a.offsetHeight;S=z+(Ce-w)*e}else"bottom"===Me&&(w=Math.max(.1,Math.min(3,Ce+t)));Ae.querySelector(".input-ref-scaley").value=w.toFixed(2),Ae.querySelector(".input-ref-y").value=S.toFixed(1),De()}}),window.addEventListener("mouseup",()=>{we&&(we=!1,Me=null)});const Ae=document.createElement("div");Ae.classList.add("edit-mode-ui"),Ae.innerHTML='\n        <button class="btn-close-edit">X</button>\n        <div class="edit-mode-indicator">EDIT MODE ACTIVE</div>\n        <div style="display: flex; gap: 10px; margin-bottom: 10px;">\n            <button class="btn-toggle-ref">Toggle Reference Map</button>\n            <button class="btn-toggle-gems">Add Gems Mode</button>\n            <button class="btn-submit">Save Locations</button>\n            <button class="btn-save-gems">Save Gems</button>\n        </div>\n        \n        <div class="ref-controls-panel">\n            <div class="ref-controls-title">Reference Map Controls</div>\n            \n            <div class="control-group">\n                <label>Position X:</label>\n                <button class="btn-adjust" data-action="x-minus">-</button>\n                <input type="number" class="input-ref-x" value="0" step="0.1">\n                <button class="btn-adjust" data-action="x-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Position Y:</label>\n                <button class="btn-adjust" data-action="y-minus">-</button>\n                <input type="number" class="input-ref-y" value="0" step="0.1">\n                <button class="btn-adjust" data-action="y-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Scale X:</label>\n                <button class="btn-adjust" data-action="scalex-minus">-</button>\n                <input type="number" class="input-ref-scalex" value="1.0" step="0.01" min="0.1" max="3">\n                <button class="btn-adjust" data-action="scalex-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Scale Y:</label>\n                <button class="btn-adjust" data-action="scaley-minus">-</button>\n                <input type="number" class="input-ref-scaley" value="1.0" step="0.01" min="0.1" max="3">\n                <button class="btn-adjust" data-action="scaley-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Opacity:</label>\n                <input type="range" class="input-ref-opacity" min="0" max="1" step="0.05" value="0.5">\n                <span class="opacity-value">0.5</span>\n            </div>\n            \n            <div class="control-group">\n                <button class="btn-reset-ref">Reset Reference Map</button>\n            </div>\n            \n            <div class="control-group">\n                <button class="btn-auto-position">Auto-Position All Points</button>\n            </div>\n            \n            <div class="coordinate-display">\n                <div>Mouse: <span class="coord-x">--</span>%, <span class="coord-y">--</span>%</div>\n            </div>\n        </div>\n    ',document.body.appendChild(Ae);const ze=e=>{u=e,u?(Ae.classList.add("active"),ne()):(Ae.classList.remove("active"),Ee.classList.remove("active"),ne())};function De(){Ee.style.transform=`translate(${E}px, ${S}px) scale(${L}, ${w})`,Ee.style.opacity=M}ke.addEventListener("click",()=>ze(!0)),Ae.querySelector(".btn-close-edit").addEventListener("click",()=>ze(!1)),Ae.querySelector(".btn-toggle-ref").addEventListener("click",()=>{Ee.classList.toggle("active")}),Ae.querySelector(".btn-toggle-gems").addEventListener("click",e=>{f=!f,e.target.textContent=f?"Stop Adding Gems":"Add Gems Mode",e.target.style.backgroundColor=f?"#FF6B6B":"",a.style.cursor=f?"crosshair":"default"}),Ae.querySelector(".btn-submit").addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(g,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","locations.json"),document.body.appendChild(t),t.click(),t.remove()}),Ae.querySelector(".btn-save-gems").addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(h,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","gems.json"),document.body.appendChild(t),t.click(),t.remove()}),Ae.querySelector('[data-action="x-minus"]').addEventListener("click",()=>{E-=.1,Ae.querySelector(".input-ref-x").value=E.toFixed(1),De()}),Ae.querySelector('[data-action="x-plus"]').addEventListener("click",()=>{E+=.1,Ae.querySelector(".input-ref-x").value=E.toFixed(1),De()}),Ae.querySelector(".input-ref-x").addEventListener("input",e=>{E=parseFloat(e.target.value)||0,De()}),Ae.querySelector('[data-action="y-minus"]').addEventListener("click",()=>{S-=.1,Ae.querySelector(".input-ref-y").value=S.toFixed(1),De()}),Ae.querySelector('[data-action="y-plus"]').addEventListener("click",()=>{S+=.1,Ae.querySelector(".input-ref-y").value=S.toFixed(1),De()}),Ae.querySelector(".input-ref-y").addEventListener("input",e=>{S=parseFloat(e.target.value)||0,De()}),Ae.querySelector('[data-action="scalex-minus"]').addEventListener("click",()=>{L=Math.max(.1,L-.01),Ae.querySelector(".input-ref-scalex").value=L.toFixed(2),De()}),Ae.querySelector('[data-action="scalex-plus"]').addEventListener("click",()=>{L=Math.min(3,L+.01),Ae.querySelector(".input-ref-scalex").value=L.toFixed(2),De()}),Ae.querySelector(".input-ref-scalex").addEventListener("input",e=>{L=parseFloat(e.target.value)||1,De()}),Ae.querySelector('[data-action="scaley-minus"]').addEventListener("click",()=>{w=Math.max(.1,w-.01),Ae.querySelector(".input-ref-scaley").value=w.toFixed(2),De()}),Ae.querySelector('[data-action="scaley-plus"]').addEventListener("click",()=>{w=Math.min(3,w+.01),Ae.querySelector(".input-ref-scaley").value=w.toFixed(2),De()}),Ae.querySelector(".input-ref-scaley").addEventListener("input",e=>{w=parseFloat(e.target.value)||1,De()}),Ae.querySelector(".input-ref-opacity").addEventListener("input",e=>{M=parseFloat(e.target.value),Ae.querySelector(".opacity-value").textContent=M.toFixed(2),De()}),Ae.querySelector(".btn-reset-ref").addEventListener("click",()=>{E=0,S=0,L=1,w=1,M=.5,Ae.querySelector(".input-ref-x").value=0,Ae.querySelector(".input-ref-y").value=0,Ae.querySelector(".input-ref-scalex").value=1,Ae.querySelector(".input-ref-scaley").value=1,Ae.querySelector(".input-ref-opacity").value=.5,Ae.querySelector(".opacity-value").textContent="0.50",De()}),a.addEventListener("mousemove",e=>{if(!u)return;const t=a.getBoundingClientRect(),n=e.clientX-t.left-c,i=e.clientY-t.top-d;let s=n/(t.width*o)*100,l=i/(t.height*o)*100;s=Math.max(0,Math.min(100,s)),l=Math.max(0,Math.min(100,l)),Ae.querySelector(".coord-x").textContent=s.toFixed(1),Ae.querySelector(".coord-y").textContent=l.toFixed(1)}),Ae.querySelector(".btn-auto-position").addEventListener("click",()=>{const e=D.offsetWidth,t=D.offsetHeight;g.forEach(n=>{if(void 0!==n.lat&&void 0!==n.lng){const i=function(e,t){const n=(t+180)/360*100,i=e*Math.PI/180;return{x:n,y:50*(1-Math.log(Math.tan(Math.PI/4+i/2))/Math.PI)}}(n.lat,n.lng);let a=i.x/100*e,s=i.y/100*t;a*=L,s*=w,a+=E,s+=S;const o=a/e*100,l=s/t*100;n.x=Math.round(10*o)/10,n.y=Math.round(10*l)/10}}),ne(),alert("All points have been auto-positioned based on their geographic coordinates and the current reference map alignment!")}),document.addEventListener("click",y),document.addEventListener("touchstart",y,{passive:!0})}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#app");e&&(e.innerHTML='\n      <div class="kiosk-container">\n        <div id="map-container"></div>\n        <div id="modal-container"></div>\n      </div>\n    ',E(document.querySelector("#map-container"),document.querySelector("#modal-container")),h())});
