const e=[{id:1,y:40.8,x:51.4,lat:49.7597,lng:16.6647,title:"Moravská Třebová",description:"Domov L. V. Holzmaistera a sídlo muzea, kam zasílal své sbírky.",image:"/assets/item_24-B3dTJIwG.jpg",region:"Europe",visitDate:"1885"},{id:2,y:47.3,x:55.5,lat:31.2001,lng:29.9187,title:"Egypt - Alexandrie",description:"Starověký přístav. Získání koptských textilií.",image:"/assets/item_18-DoT3thrQ.jpg",region:"North Africa",visitDate:"1891"},{id:3,y:47.3,x:56.9,lat:30.0444,lng:31.2357,title:"Egypt - Káhira",description:"Centrum obchodu na Blízkém východě. Nákup starožitností na trhu Chán al-Chalílí.",image:"/assets/item_17-1ZhEYkNL.jpg",region:"North Africa",visitDate:"1891"},{id:4,y:48.9,x:57.7,lat:29.9668,lng:32.5498,title:"Egypt - Suez",description:"Průjezd Suezským průplavem, klíčovým bodem cesty na východ.",image:"/assets/item_19-CkcTAOk6.jpg",region:"North Africa",visitDate:"1891"},{id:5,y:52,x:62,lat:12.8654,lng:45.0187,title:"Jemen - Aden",description:"Důležitá zastávka pro doplnění uhlí. Nákup aromatických pryskyřic.",image:"/assets/item_20-CDVLsI3n.jpg",region:"Middle East",visitDate:"1891"},{id:6,y:54.2,x:70.1,lat:6.9271,lng:79.8612,title:"Srí Lanka - Kolombo",description:"Zastávka na cestě do Asie. Nákup drahokamů a tradičních masek.",image:"/assets/item_7-BRWFh9Gf.jpg",region:"South Asia",visitDate:"1891"},{id:7,y:56.9,x:75.6,lat:1.3521,lng:103.8198,title:"Singapur",description:"Křižovatka obchodních cest. Zde se Holzmaister setkal s obchodníky z celého světa.",image:"/assets/item_12-Bjrxq-OF.jpg",region:"South East Asia",visitDate:"1891"},{id:8,y:58.3,x:77.2,lat:-6.2088,lng:106.8456,title:"Indonésie - Batávie (Jakarta)",description:"Nizozemská východní Indie. Sběr krisů (tradičních dýk) a batikovaných látek.",image:"/assets/item_11-BD6GxIsu.jpg",region:"South East Asia",visitDate:"1891"},{id:9,y:54.4,x:74.9,lat:13.7563,lng:100.5018,title:"Thajsko - Bangkok",description:"Království Siam. Návštěva chrámů a získání sošky Buddhy.",image:"/assets/item_13-B2nW9kzq.jpg",region:"South East Asia",visitDate:"1892"},{id:10,y:51.7,x:68.2,lat:19.076,lng:72.8777,title:"Indie - Bombaj",description:"Vstupní brána do Indie. Fascinace rušnými trhy a architekturou viktoriánské gotiky.",image:"/assets/item_8-BjFy_xSY.jpg",region:"South Asia",visitDate:"1892"},{id:11,y:48.9,x:68,lat:28.7041,lng:77.1025,title:"Indie - Dillí",description:"Návštěva Červené pevnosti a získání mogulskejch miniatur.",image:"/assets/item_9-DFYqy_on.jpg",region:"South Asia",visitDate:"1892"},{id:12,y:50.1,x:70.7,lat:25.3176,lng:82.9739,title:"Indie - Váránasí",description:"Posvátné město na Ganze. Pozorování rituálů a nákup rituálních nádob.",image:"/assets/item_10-DDMb1O7y.jpg",region:"South Asia",visitDate:"1892"},{id:13,y:48.8,x:79.4,lat:31.2304,lng:121.4737,title:"Čína - Šanghaj",description:"Rušný přístav a brána do Číny. Sbírka obsahuje porcelánové vázy z dynastie Čching zakoupené na nábřeží Bund.",image:"/assets/item_4-ivSOk76L.jpg",region:"East Asia",visitDate:"1892"},{id:14,y:51.9,x:76.6,lat:22.3193,lng:114.1694,title:"Čína - Hongkong",description:"Britská kolonie v době návštěvy. Holzmaistera fascinovala směs východní a západní architektury.",image:"/assets/item_5-DZ-LVrx_.jpg",region:"East Asia",visitDate:"1892"},{id:15,y:47.2,x:78.3,lat:39.9042,lng:116.4074,title:"Čína - Peking",description:"Návštěva Zakázaného města. Získání tradičního hedvábného oděvu pro muzeum.",image:"https://images.unsplash.com/photo-1508804185872-d7badad00f7d?auto=format&fit=crop&q=80&w=800",region:"East Asia",visitDate:"1892"},{id:16,y:44.5,x:85.3,lat:35.4437,lng:139.638,title:"Japonsko - Jokohama",description:"Hlavní přístav, kterým Holzmaister připlul do Japonska. Zde zakoupil 'Japonské album' s ručně kolorovanými fotografiemi.",image:"/assets/item_3-DE28AY0g.jpg",region:"East Asia",visitDate:"1893"},{id:17,y:46.2,x:84.5,lat:35.6762,lng:139.6503,title:"Japonsko - Tokio",description:"Císařské město, kde Holzmaister strávil několik týdnů. Zde získal vzácné lakované krabičky a samurajské doplňky.",image:"/assets/item_1-DrqqKa96.jpg",region:"East Asia",visitDate:"1893"},{id:18,y:45.3,x:83.9,lat:35.0116,lng:135.7681,title:"Japonsko - Kjóto",description:"Starobylé hlavní město. Fotografie zachycuje chrám Kinkaku-dži, který Holzmaister navštívil během období kvetoucích sakur.",image:"/assets/item_2-Baq8goSb.jpg",region:"East Asia",visitDate:"1893"},{id:19,y:61.2,x:95.1,lat:-17.7134,lng:178.065,title:"Fidži",description:"Exotická zastávka v Pacifiku. Ukázky domorodého umění.",image:"/assets/item_25-DPAhJq_6.jpg",region:"Oceania",visitDate:"1893"},{id:20,y:68.1,x:94.1,lat:-36.8485,lng:174.7633,title:"Nový Zéland - Auckland",description:"Setkání s Maorskou kulturou. Do sbírky přibyly řezby ze dřeva a nefritu.",image:"/assets/item_16-DrGYJ_Zf.jpg",region:"Oceania",visitDate:"1893"},{id:21,y:65.1,x:88.2,lat:-33.8688,lng:151.2093,title:"Austrálie - Sydney",description:"Přístavní město v Oceánii. Získání domorodých artefaktů a bumerangů.",image:"/assets/item_14-BZKrRsd6.jpg",region:"Australia",visitDate:"1893"},{id:22,y:67.6,x:86.8,lat:-37.8136,lng:144.9631,title:"Austrálie - Melbourne",description:"Bohaté město díky zlaté horečce. Návštěva botanických zahrad.",image:"/assets/item_15-BJDAOYzP.jpg",region:"Australia",visitDate:"1893"},{id:23,y:46.4,x:58.4,lat:31.7683,lng:35.2137,title:"Jeruzalém",description:"Svaté město. Získání upomínkových předmětů z olivového dřeva.",image:"/assets/item_21-gRTCLDlV.jpg",region:"Middle East",visitDate:"1894"},{id:24,y:45.1,x:58.7,lat:33.5138,lng:36.2765,title:"Damašek",description:"Jedno z nejstarších měst. Obdivování damašské oceli a látek.",image:"/assets/item_22-DX80tEcQ.jpg",region:"Middle East",visitDate:"1894"},{id:25,y:44.8,x:28.2,lat:40.7128,lng:-74.006,title:"New York",description:"Dlouhodobé působení Holzmaistera v USA, odkud podporoval muzeum.",image:"/assets/item_23-C2ramuXH.jpg",region:"North America",visitDate:"1895-1920"}],t="antigravity_gem_hints",n="antigravity_revealed_gems";function i(e=25){let n=a();return n&&0!==Object.keys(n).length||(n=function(e){const t={},n=[1,2,3,4,5],i=Array.from({length:e},(e,t)=>t+1),a=i.sort(()=>Math.random()-.5);return a.slice(0,5).forEach((e,i)=>{t[e]=n[i]}),t}(e),function(e){try{localStorage.setItem(t,JSON.stringify(e))}catch(n){console.error("Error saving gem hints:",n)}}(n)),n}function a(){try{const e=localStorage.getItem(t);return e?JSON.parse(e):{}}catch(e){return console.error("Error loading gem hints:",e),{}}}function o(){try{const e=localStorage.getItem(n);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading revealed gems:",e),[]}}function s(e,t){const i=o(),a=t.filter(t=>t.type===e).map(e=>e.id),s=[...new Set([...i,...a])];return function(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(t){console.error("Error saving revealed gems:",t)}}(s),s}function l(e){return o().includes(e)}const r=[{id:1,x:15.5,y:23.2,code:"TRA-1888",type:1,revealed:!1},{id:2,x:45.3,y:12.8,code:"TRA-3421",type:1,revealed:!1},{id:3,x:72.1,y:65.4,code:"TRA-5692",type:1,revealed:!1},{id:4,x:45.8,y:67.3,code:"MOR-2341",type:2,revealed:!1},{id:5,x:18.6,y:54.7,code:"MOR-7823",type:2,revealed:!1},{id:6,x:83.2,y:28.9,code:"MOR-4156",type:2,revealed:!1},{id:7,x:78.2,y:34.6,code:"JAP-5729",type:3,revealed:!1},{id:8,x:32.4,y:78.1,code:"JAP-9184",type:3,revealed:!1},{id:9,x:56.7,y:19.3,code:"JAP-2637",type:3,revealed:!1},{id:10,x:62.1,y:52.8,code:"IND-8432",type:4,revealed:!1},{id:11,x:24.8,y:38.5,code:"IND-1947",type:4,revealed:!1},{id:12,x:91.3,y:71.2,code:"IND-5281",type:4,revealed:!1},{id:13,x:88.7,y:71.4,code:"AUS-3156",type:5,revealed:!1},{id:14,x:12.9,y:58.6,code:"AUS-7429",type:5,revealed:!1},{id:15,x:67.5,y:43.9,code:"AUS-8163",type:5,revealed:!1}],d="/assets/gem_01-CZMZIHlm.png",c="/assets/gem_02-Bp-ud6f4.png",u="/assets/gem_03-DfWzPX7L.png",v="/assets/gem_04-C8DOo_w2.png",m="/assets/gem_05-Be9G19XQ.png",p={1:d,2:c,3:u,4:v,5:m};let g=null;function h(e,t,n=[],i=null){y();const o=document.createElement("div");o.classList.add("modal-overlay");const d=n.findIndex(t=>t.id===e.id),c=(d-1+n.length)%n.length,u=(d+1)%n.length,v=(m=e.id,a()[m]||null);var m;let h="";if(v){const e=r.some(e=>e.type===v&&l(e.id));h=`\n        <div class="gem-hint-bar">\n            <div class="gem-hint-content">\n                <img src="${p[v]}" alt="Gem Hint" class="gem-hint-icon">\n                <div class="gem-hint-text">\n                    <strong>Hidden Gem Detected!</strong>\n                    <span>This location holds a clue to finding rare crystals.</span>\n                </div>\n                <button class="${e?"gem-reveal-btn disabled":"gem-reveal-btn"}" data-gem-type="${v}" ${e?"disabled":""}>\n                    ${e?"Gems Revealed!":"Unhide Gems on Map"}\n                </button>\n            </div>\n        </div>\n      `}o.innerHTML=`\n    <div class="modal-content">\n      <div class="modal-image-container">\n        ${h}\n        <img src="${e.image}" alt="${e.title}" class="modal-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">\n        <div class="modal-image-placeholder" style="display: none;">\n            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="1">\n                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n                <circle cx="8.5" cy="8.5" r="1.5"/>\n                <polyline points="21 15 16 10 5 21"/>\n            </svg>\n            <span>Chybí fotografie</span>\n        </div>\n        <div class="modal-region-tag">${e.region}</div>\n      </div>\n      <div class="modal-info">\n        <button class="close-button">\n            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">\n                <line x1="18" y1="6" x2="6" y2="18"></line>\n                <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n        </button>\n        <div class="modal-location-label">\n            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n                <circle cx="12" cy="10" r="3"></circle>\n            </svg>\n            LOKACE Č. ${e.id}\n        </div>\n        <h2 class="modal-title">${e.title}</h2>\n        ${e.visitDate?`<div class="modal-visit-date">Navštíveno: ${e.visitDate}</div>`:""}\n        <div class="modal-divider"></div>\n        <p class="modal-description">${e.description}</p>\n        \n        <div class="modal-nav-buttons">\n            <button class="nav-btn prev-btn">\n                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">\n                    <polyline points="15 18 9 12 15 6"></polyline>\n                </svg>\n                Předchozí\n            </button>\n            <button class="nav-btn next-btn">\n                Další\n                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">\n                    <polyline points="9 18 15 12 9 6"></polyline>\n                </svg>\n            </button>\n        </div>\n\n        <div class="modal-footer">Sbírka L. V. Holzmaistera</div>\n      </div>\n    </div>\n    `,t.appendChild(o),requestAnimationFrame(()=>{o.classList.add("active")});o.querySelector(".close-button").addEventListener("click",y),o.addEventListener("click",e=>{e.target===o&&y()});const f=o.querySelector(".gem-reveal-btn");f&&!f.classList.contains("disabled")&&f.addEventListener("click",e=>{e.stopPropagation();const t=parseInt(f.dataset.gemType);s(t,r),f.textContent="Gems Revealed!",f.classList.add("disabled"),f.disabled=!0,window.dispatchEvent(new CustomEvent("gemRevealed",{detail:{gemType:t}}))}),i&&(o.querySelector(".prev-btn").addEventListener("click",()=>{o.classList.remove("active"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o),g=null,i(c)},3e3)}),o.querySelector(".next-btn").addEventListener("click",()=>{o.classList.remove("active"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o),g=null,i(u)},3e3)})),g=o}function y(){if(g){const e=g;e.classList.remove("active"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},3e3),g=null}}class f{constructor(e){this.onStart=e,this.overlay=null,this.init()}init(){this.overlay=document.createElement("div"),this.overlay.classList.add("idle-screen-overlay"),this.overlay.innerHTML='\n            <div class="start-game-container">\n                <img src="/assets/start_jorney-B-vkNHQ0.png" class="start-game-bg" alt="Start Journey">\n                <button class="start-game-btn">\n                    <img src="/assets/start_button-C0gmB8GR.png" alt="Start Game">\n                </button>\n            </div>\n        ',this.overlay.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.4);\n            backdrop-filter: blur(8px);\n            -webkit-backdrop-filter: blur(8px);\n            z-index: 999999;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            opacity: 0;\n            pointer-events: none;\n            transition: opacity 0.5s ease;\n        ",document.body.appendChild(this.overlay);const e=this.overlay.querySelector(".start-game-btn");e&&e.addEventListener("click",e=>{e.stopPropagation(),this.hide(),this.onStart&&this.onStart()})}show(){this.overlay&&(console.log("Showing Start Page"),this.overlay.style.opacity="1",this.overlay.style.pointerEvents="auto",setTimeout(()=>{window.dispatchEvent(new CustomEvent("gameReset"))},100))}hide(){this.overlay&&(console.log("Hiding Start Page"),this.overlay.style.opacity="0",this.overlay.style.pointerEvents="none")}}let b,x;let k=null;function E(){console.log("=== IDLE TIMER INIT START ==="),k=new f(()=>{console.log("Start Game clicked - starting idle tracking"),function(){console.log("Starting idle tracking..."),S();["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(e=>{document.addEventListener(e,S,{passive:!0})})}()}),console.log("Initializing IdleTimer - Showing Start Page"),requestAnimationFrame(()=>{k.show(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("gameReset"))},100)}),console.log("=== IDLE TIMER INIT END ===")}function S(){clearTimeout(b),clearTimeout(x),x=setTimeout(L,6e4),b=setTimeout(w,12e4)}function L(){console.log("1 minute idle - resetting zoom..."),window.dispatchEvent(new CustomEvent("zoomReset"))}function w(){console.log("2 minutes idle - showing Start Game page..."),y(),k&&k.show(),window.dispatchEvent(new CustomEvent("gameReset"))}let M=null;function q(){if(M){const e=M;e.classList.remove("active"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500),M=null}}const C={1:d,2:c,3:u,4:v,5:m};function D(a,o){let s=1,d=0,c=0,u=!1,v=!1,m=null,p=[...e],g=[...r],y=!1,f={x:0,y:0},b=0,x=0,k=1,E=1,L=.5,w=!1,D=0,A=0,j=0,z=0;i(e.length);const T=document.createElement("div");T.classList.add("map-content-wrapper"),a.appendChild(T);const _=document.createElement("div");_.classList.add("map-background-container");const $=[{src:"/assets/16k_aa-DcSpPsL4.jpg",position:"top-left",element:null},{src:"/assets/16k_ab-no00rKNZ.jpg",position:"top-right",element:null},{src:"/assets/16k_ba-CcfPJy1z.jpg",position:"bottom-left",element:null},{src:"/assets/16k_bb-DPfEk5Xw.jpg",position:"bottom-right",element:null}],I=document.createElement("div");function F(){const e=a.getBoundingClientRect(),t=e.width/2,n=(e.height/2-B)/N,i=(t-R)/N/T.offsetWidth*100;let o="";return o=n/T.offsetHeight*100<50?i<50?"16k_aa.jpg":"16k_ab.jpg":i<50?"16k_ba.jpg":"16k_bb.jpg",o}I.classList.add("tiles-16k-container"),I.style.cssText="\n        position: relative;\n        width: 100%;\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        grid-template-rows: 1fr 1fr;\n        z-index: 1;\n    ",$.forEach(e=>{const t=document.createElement("img");t.src=e.src,t.style.cssText="width: 100%; height: auto; display: block; object-fit: cover;",t.ondragstart=e=>e.preventDefault(),I.appendChild(t),e.element=t}),_.appendChild(I),T.appendChild(_);let N=1,R=0,B=0,H=1,P=0,Y=0;const J=16;let O,X=null;function G(){clearTimeout(O),O=setTimeout(()=>{const e=Z();H=e,P=0,Y=0,ee()},6e4)}function Z(){a.offsetWidth;const e=a.offsetHeight;T.offsetWidth;const t=T.offsetHeight||e;return 0===t?1:Math.max(1,e/t)}G();let W=null;function K(e,t=!0){if(e<0||e>=p.length)return;const n=p[e];T.querySelectorAll(".map-point").forEach(e=>e.classList.remove("active"));const i=T.querySelector(`.map-point[data-id="${n.id}"]`);i&&i.classList.add("active");const s=a.getBoundingClientRect(),l=s.width/2,r=s.height/2,d=T.offsetWidth,c=T.offsetHeight,u=n.x/100*d,v=n.y/100*c;if(t){let e=2*H;e<2&&(e=2),e>J&&(e=J),H=e,W=e}else W&&(H=W);P=l-u*H,Y=r-v*H,ee(),X=()=>{h(n,o,p,e=>{K(e,!1)}),S(),G()}}function U(){T.querySelectorAll(".map-point").forEach(e=>e.remove()),p.forEach((e,t)=>{const n=document.createElement("div");n.classList.add("map-point"),u&&n.classList.add("draggable"),n.style.left=`${e.x}%`,n.style.top=`${e.y}%`,n.dataset.id=e.id;const i=document.createElement("div");i.classList.add("map-point-label"),i.textContent=e.title,n.appendChild(i);const a=e=>{u||(e.stopPropagation(),S(),G(),K(t))};n.addEventListener("click",a),n.addEventListener("touchstart",e=>{u||a(e)},{passive:!0}),n.addEventListener("mousedown",t=>{u&&(t.stopPropagation(),v=!0,m=e.id,n.classList.add("dragging"))}),T.appendChild(n)})}function V(){T.querySelectorAll(".gem-point").forEach(e=>e.remove()),g.forEach(e=>{const t=document.createElement("div");t.classList.add("gem-point"),t.style.left=`${e.x}%`,t.style.top=`${e.y}%`,t.dataset.id=e.id;const n=e.type||e.id%5+1;t.style.backgroundImage=`url('${C[n]}')`,t.addEventListener("click",t=>{u||y||(t.stopPropagation(),function(e,t,n){q();const i=document.createElement("div");i.classList.add("gem-modal-overlay");const a=n;i.innerHTML=`\n        <div class="gem-modal-content">\n            <div class="gem-modal-icon">\n                <img src="${a}" alt="Gem" style="width: 80px; height: 80px; object-fit: contain;">\n            </div>\n            <h2 class="gem-modal-title">Hidden Artifact Found!</h2>\n            <p class="gem-modal-subtitle">You have discovered a secret location.</p>\n            <div class="gem-modal-code-label">SECRET CODE</div>\n            <div class="gem-modal-code">${e.code}</div>\n            <button class="gem-modal-close">Close</button>\n        </div>\n    `,t.appendChild(i),requestAnimationFrame(()=>{i.classList.add("active")}),i.querySelector(".gem-modal-close").addEventListener("click",q),i.addEventListener("click",e=>{e.target===i&&q()}),M=i}(e,o,C[n]),S(),G())}),T.appendChild(t)}),Q()}function Q(){T.querySelectorAll(".gem-point").forEach(e=>{const t=l(parseInt(e.dataset.id));N>=8||t?(e.classList.add("visible"),t&&N<8?e.classList.add("revealed-low-zoom"):e.classList.remove("revealed-low-zoom")):(e.classList.remove("visible"),e.classList.remove("revealed-low-zoom"))})}function ee(){const e=a.offsetWidth,t=a.offsetHeight,n=T.offsetWidth,i=T.offsetHeight,o=Z();H<o&&(H=o),H>J&&(H=J);const s=e-n*H,l=t-i*H;P=Math.min(Math.max(P,s),0),Y=Math.min(Math.max(Y,l),0)}U(),window.addEventListener("gemRevealed",()=>{Q()}),window.addEventListener("zoomReset",()=>{console.log("Zoom resetting to initial view...");const e=Z();H=e,P=0,Y=0,ee()}),window.addEventListener("gameReset",()=>{console.log("Game Resetting..."),localStorage.removeItem(t),localStorage.removeItem(n);const a=[];for(let e=1;e<=5;e++)for(let t=0;t<3;t++)a.push(e);for(let e=a.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}g.forEach((e,t)=>{t<a.length&&(e.type=a[t])}),i(e.length),V();const o=Z();H=o,P=0,Y=0,ee()}),V();let te=null,ne={version:"...",prompts:0,timeSpentMinutes:0};function ie(e){return`${Math.floor(e/60)}h ${e%60}m`}function ae(e){if(!te)return;const t=te.querySelector(".debug-version"),n=te.querySelector(".debug-bg-name"),i=te.querySelector(".debug-zoom-value"),a=te.querySelector(".debug-x"),o=te.querySelector(".debug-y");t&&(t.textContent=`v${ne.version} | P: ${ne.prompts} | T: ${ie(ne.timeSpentMinutes)}`),n&&(n.textContent=e),i&&(i.textContent=`${N.toFixed(2)}x`),a&&(a.textContent=f.x.toFixed(1)),o&&(o.textContent=f.y.toFixed(1))}te=document.createElement("div"),te.classList.add("debug-panel"),te.innerHTML=`\n            <div class="debug-version">v${ne.version} | P: ${ne.prompts} | T: ${ie(ne.timeSpentMinutes)}</div>\n            <div class="debug-date">${(new Date).toLocaleDateString("cs-CZ")}</div>\n            <div class="debug-bg">BG: <span class="debug-bg-name">...</span></div>\n            <div class="debug-zoom">Zoom: <span class="debug-zoom-value">1.00x</span></div>\n            <div class="debug-coords">X: <span class="debug-x">0</span>% Y: <span class="debug-y">0</span>%</div>\n        `,document.body.appendChild(te),async function(){try{const e=await fetch("/production.json");ne=await e.json(),ae(F())}catch(e){console.error("Failed to load production data",e)}}(),requestAnimationFrame(function e(){const t=Math.abs(P-R),n=Math.abs(Y-B),i=Math.abs(H-N),a=Math.sqrt(t*t+n*n)+100*i,o=Math.min(a/1e3,1);var l;const r=.05+.05*((l=1-o)<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2);R+=(P-R)*r,B+=(Y-B)*r,N+=(H-N)*r,Math.abs(P-R)<.5&&Math.abs(Y-B)<.5&&Math.abs(H-N)<.005&&(R=P,B=Y,N=H,X&&(X(),X=null)),T.style.transform=`translate(${R}px, ${B}px) scale(${N})`,ae(F()),Q(),s=N,d=R,c=B,requestAnimationFrame(e)}),a.addEventListener("wheel",e=>{e.preventDefault(),S(),G();const t=a.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,o=(n-P)/H,s=(i-Y)/H;-e.deltaY>0?H*=1.2:H/=1.2,ee(),P=n-o*H,Y=i-s*H,ee()},{passive:!1}),a.addEventListener("dblclick",e=>{e.preventDefault(),S(),G();const t=a.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top;let o=2*H;o>J&&(o=J);const s=t.width/2,l=t.height/2,r=(n-P)/H,d=(i-Y)/H;H=o,P=s-r*H,Y=l-d*H,ee()});let oe=!1,se=0,le=0,re=null,de=1;function ce(e){const t=e[0].clientX-e[1].clientX,n=e[0].clientY-e[1].clientY;return Math.hypot(t,n)}function ue(e){return{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}function ve(e){if(!u||!v)if(S(),G(),e.touches){if(1===e.touches.length)oe=!0,se=e.touches[0].clientX,le=e.touches[0].clientY,a.style.cursor="grabbing";else if(2===e.touches.length){oe=!1,re=ce(e.touches),de=H;const t=ue(e.touches);se=t.x,le=t.y}}else oe=!0,se=e.clientX,le=e.clientY,a.style.cursor="grabbing"}function me(e){S(),G();const t=e.clientX||(e.touches?e.touches[0].clientX:0),n=e.clientY||(e.touches?e.touches[0].clientY:0),i=a.getBoundingClientRect(),o=t-i.left,s=n-i.top,l=(o-R)/N,r=(s-B)/N,d=T.offsetWidth,c=T.offsetHeight;if(f.x=l/d*100,f.y=r/c*100,u&&v&&m){e.preventDefault();let t=f.x,n=f.y;t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n));const i=T.querySelector(`.map-point[data-id="${m}"]`);i&&(i.style.left=`${t}%`,i.style.top=`${n}%`);const a=p.findIndex(e=>e.id===m);-1!==a&&(p[a].x=Math.round(10*t)/10,p[a].y=Math.round(10*n)/10);const o=we.querySelector(".coord-x"),s=we.querySelector(".coord-y");return void(o&&s&&(o.textContent=t.toFixed(1),s.textContent=n.toFixed(1)))}if(e.touches&&2===e.touches.length){e.preventDefault();const t=ce(e.touches);if(re){H=de*(t/re);const n=ue(e.touches),i=n.x-se,a=n.y-le;P+=i,Y+=a,se=n.x,le=n.y,ee()}}else if(oe){e.preventDefault();P+=t-se,Y+=n-le,se=t,le=n,ee()}}function pe(e){if(y&&!oe){if(e.clientX||e.changedTouches&&e.changedTouches[0].clientX,e.clientY||e.changedTouches&&e.changedTouches[0].clientY,e.target.closest(".edit-mode-ui")||e.target.closest(".map-point"))return;const t={id:g.length+1,x:Math.round(10*f.x)/10,y:Math.round(10*f.y)/10,code:ge()};return g.push(t),void V()}if(oe=!1,re=null,a.style.cursor="default",v){v=!1;const e=T.querySelector(`.map-point[data-id="${m}"]`);e&&e.classList.remove("dragging"),m=null}}function ge(){const e=["TRA","MOR","JAP","IND","AUS","EGY","CHN"];return`${e[Math.floor(Math.random()*e.length)]}-${Math.floor(9e3*Math.random())+1e3}`}a.addEventListener("mousedown",ve),a.addEventListener("touchstart",ve,{passive:!1}),window.addEventListener("mousemove",me),window.addEventListener("touchmove",me,{passive:!1}),window.addEventListener("mouseup",pe),window.addEventListener("touchend",pe),window.addEventListener("resize",()=>{ee()}),$[0].element&&($[0].element.onload=()=>{ee(),R=P,B=Y,N=H});const he=document.createElement("div");he.classList.add("admin-trigger"),he.innerHTML='\n        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>\n        </svg>\n    ',he.title="Edit Mode",document.body.appendChild(he);const ye=document.createElement("div");ye.classList.add("reference-overlay"),T.insertBefore(ye,T.firstChild);const fe=document.createElement("div");fe.classList.add("ref-handle","ref-handle-top"),fe.innerHTML='<div class="handle-line"></div>',ye.appendChild(fe);const be=document.createElement("div");be.classList.add("ref-handle","ref-handle-bottom"),be.innerHTML='<div class="handle-line"></div>',ye.appendChild(be),ye.addEventListener("mousedown",e=>{u&&ye.classList.contains("active")&&(e.target.closest(".ref-handle")||(w=!0,D=e.clientX,A=e.clientY,j=b,z=x,ye.style.cursor="grabbing",e.stopPropagation()))}),window.addEventListener("mousemove",e=>{if(w){const t=e.clientX-D,n=e.clientY-A;b=j+t,x=z+n,we.querySelector(".input-ref-x").value=b.toFixed(1),we.querySelector(".input-ref-y").value=x.toFixed(1),qe()}}),window.addEventListener("mouseup",()=>{w&&(w=!1,ye.style.cursor="grab")});let xe=!1,ke=null,Ee=0,Se=1;function Le(e,t){u&&ye.classList.contains("active")&&(xe=!0,ke=t,Ee=e.clientY,Se=E,e.stopPropagation(),e.preventDefault())}fe.addEventListener("mousedown",e=>Le(e,"top")),be.addEventListener("mousedown",e=>Le(e,"bottom")),window.addEventListener("mousemove",e=>{if(xe){const t=(e.clientY-Ee)/500;if("top"===ke){E=Math.max(.1,Math.min(3,Se-t));const e=a.offsetHeight;x=z+(Se-E)*e}else"bottom"===ke&&(E=Math.max(.1,Math.min(3,Se+t)));we.querySelector(".input-ref-scaley").value=E.toFixed(2),we.querySelector(".input-ref-y").value=x.toFixed(1),qe()}}),window.addEventListener("mouseup",()=>{xe&&(xe=!1,ke=null)});const we=document.createElement("div");we.classList.add("edit-mode-ui"),we.innerHTML='\n        <button class="btn-close-edit">X</button>\n        <div class="edit-mode-indicator">EDIT MODE ACTIVE</div>\n        <div style="display: flex; gap: 10px; margin-bottom: 10px;">\n            <button class="btn-toggle-ref">Toggle Reference Map</button>\n            <button class="btn-toggle-gems">Add Gems Mode</button>\n            <button class="btn-submit">Save Locations</button>\n            <button class="btn-save-gems">Save Gems</button>\n        </div>\n        \n        <div class="ref-controls-panel">\n            <div class="ref-controls-title">Reference Map Controls</div>\n            \n            <div class="control-group">\n                <label>Position X:</label>\n                <button class="btn-adjust" data-action="x-minus">-</button>\n                <input type="number" class="input-ref-x" value="0" step="0.1">\n                <button class="btn-adjust" data-action="x-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Position Y:</label>\n                <button class="btn-adjust" data-action="y-minus">-</button>\n                <input type="number" class="input-ref-y" value="0" step="0.1">\n                <button class="btn-adjust" data-action="y-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Scale X:</label>\n                <button class="btn-adjust" data-action="scalex-minus">-</button>\n                <input type="number" class="input-ref-scalex" value="1.0" step="0.01" min="0.1" max="3">\n                <button class="btn-adjust" data-action="scalex-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Scale Y:</label>\n                <button class="btn-adjust" data-action="scaley-minus">-</button>\n                <input type="number" class="input-ref-scaley" value="1.0" step="0.01" min="0.1" max="3">\n                <button class="btn-adjust" data-action="scaley-plus">+</button>\n            </div>\n            \n            <div class="control-group">\n                <label>Opacity:</label>\n                <input type="range" class="input-ref-opacity" min="0" max="1" step="0.05" value="0.5">\n                <span class="opacity-value">0.5</span>\n            </div>\n            \n            <div class="control-group">\n                <button class="btn-reset-ref">Reset Reference Map</button>\n            </div>\n            \n            <div class="control-group">\n                <button class="btn-auto-position">Auto-Position All Points</button>\n            </div>\n            \n            <div class="coordinate-display">\n                <div>Mouse: <span class="coord-x">--</span>%, <span class="coord-y">--</span>%</div>\n            </div>\n        </div>\n    ',document.body.appendChild(we);const Me=e=>{u=e,u?(we.classList.add("active"),U()):(we.classList.remove("active"),ye.classList.remove("active"),U())};function qe(){ye.style.transform=`translate(${b}px, ${x}px) scale(${k}, ${E})`,ye.style.opacity=L}he.addEventListener("click",()=>Me(!0)),we.querySelector(".btn-close-edit").addEventListener("click",()=>Me(!1)),we.querySelector(".btn-toggle-ref").addEventListener("click",()=>{ye.classList.toggle("active")}),we.querySelector(".btn-toggle-gems").addEventListener("click",e=>{y=!y,e.target.textContent=y?"Stop Adding Gems":"Add Gems Mode",e.target.style.backgroundColor=y?"#FF6B6B":"",a.style.cursor=y?"crosshair":"default"}),we.querySelector(".btn-submit").addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(p,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","locations.json"),document.body.appendChild(t),t.click(),t.remove()}),we.querySelector(".btn-save-gems").addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(g,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","gems.json"),document.body.appendChild(t),t.click(),t.remove()}),we.querySelector('[data-action="x-minus"]').addEventListener("click",()=>{b-=.1,we.querySelector(".input-ref-x").value=b.toFixed(1),qe()}),we.querySelector('[data-action="x-plus"]').addEventListener("click",()=>{b+=.1,we.querySelector(".input-ref-x").value=b.toFixed(1),qe()}),we.querySelector(".input-ref-x").addEventListener("input",e=>{b=parseFloat(e.target.value)||0,qe()}),we.querySelector('[data-action="y-minus"]').addEventListener("click",()=>{x-=.1,we.querySelector(".input-ref-y").value=x.toFixed(1),qe()}),we.querySelector('[data-action="y-plus"]').addEventListener("click",()=>{x+=.1,we.querySelector(".input-ref-y").value=x.toFixed(1),qe()}),we.querySelector(".input-ref-y").addEventListener("input",e=>{x=parseFloat(e.target.value)||0,qe()}),we.querySelector('[data-action="scalex-minus"]').addEventListener("click",()=>{k=Math.max(.1,k-.01),we.querySelector(".input-ref-scalex").value=k.toFixed(2),qe()}),we.querySelector('[data-action="scalex-plus"]').addEventListener("click",()=>{k=Math.min(3,k+.01),we.querySelector(".input-ref-scalex").value=k.toFixed(2),qe()}),we.querySelector(".input-ref-scalex").addEventListener("input",e=>{k=parseFloat(e.target.value)||1,qe()}),we.querySelector('[data-action="scaley-minus"]').addEventListener("click",()=>{E=Math.max(.1,E-.01),we.querySelector(".input-ref-scaley").value=E.toFixed(2),qe()}),we.querySelector('[data-action="scaley-plus"]').addEventListener("click",()=>{E=Math.min(3,E+.01),we.querySelector(".input-ref-scaley").value=E.toFixed(2),qe()}),we.querySelector(".input-ref-scaley").addEventListener("input",e=>{E=parseFloat(e.target.value)||1,qe()}),we.querySelector(".input-ref-opacity").addEventListener("input",e=>{L=parseFloat(e.target.value),we.querySelector(".opacity-value").textContent=L.toFixed(2),qe()}),we.querySelector(".btn-reset-ref").addEventListener("click",()=>{b=0,x=0,k=1,E=1,L=.5,we.querySelector(".input-ref-x").value=0,we.querySelector(".input-ref-y").value=0,we.querySelector(".input-ref-scalex").value=1,we.querySelector(".input-ref-scaley").value=1,we.querySelector(".input-ref-opacity").value=.5,we.querySelector(".opacity-value").textContent="0.50",qe()}),a.addEventListener("mousemove",e=>{if(!u)return;const t=a.getBoundingClientRect(),n=e.clientX-t.left-d,i=e.clientY-t.top-c;let o=n/(t.width*s)*100,l=i/(t.height*s)*100;o=Math.max(0,Math.min(100,o)),l=Math.max(0,Math.min(100,l)),we.querySelector(".coord-x").textContent=o.toFixed(1),we.querySelector(".coord-y").textContent=l.toFixed(1)}),we.querySelector(".btn-auto-position").addEventListener("click",()=>{const e=T.offsetWidth,t=T.offsetHeight;p.forEach(n=>{if(void 0!==n.lat&&void 0!==n.lng){const i=function(e,t){const n=(t+180)/360*100,i=e*Math.PI/180;return{x:n,y:50*(1-Math.log(Math.tan(Math.PI/4+i/2))/Math.PI)}}(n.lat,n.lng);let a=i.x/100*e,o=i.y/100*t;a*=k,o*=E,a+=b,o+=x;const s=a/e*100,l=o/t*100;n.x=Math.round(10*s)/10,n.y=Math.round(10*l)/10}}),U(),alert("All points have been auto-positioned based on their geographic coordinates and the current reference map alignment!")}),document.addEventListener("click",S),document.addEventListener("touchstart",S,{passive:!0})}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("#app");e&&(e.innerHTML='\n      <div class="kiosk-container">\n        <div id="map-container"></div>\n        <div id="modal-container"></div>\n      </div>\n    ',D(document.querySelector("#map-container"),document.querySelector("#modal-container")),E())});
