const ct="/assets/item_1-DrqqKa96.jpg",rt="/assets/item_2-Baq8goSb.jpg",dt="/assets/item_3-DE28AY0g.jpg",ut="/assets/item_4-ivSOk76L.jpg",mt="/assets/item_5-DZ-LVrx_.jpg",gt="/assets/item_7-BRWFh9Gf.jpg",pt="/assets/item_8-BjFy_xSY.jpg",vt="/assets/item_9-DFYqy_on.jpg",ht="/assets/item_10-DDMb1O7y.jpg",ft="/assets/item_11-BD6GxIsu.jpg",yt="/assets/item_12-Bjrxq-OF.jpg",bt="/assets/item_13-B2nW9kzq.jpg",xt="/assets/item_14-BZKrRsd6.jpg",kt="/assets/item_15-BJDAOYzP.jpg",St="/assets/item_16-DrGYJ_Zf.jpg",Et="/assets/item_17-1ZhEYkNL.jpg",Lt="/assets/item_18-DoT3thrQ.jpg",Mt="/assets/item_19-CkcTAOk6.jpg",wt="/assets/item_20-CDVLsI3n.jpg",Dt="/assets/item_21-gRTCLDlV.jpg",Tt="/assets/item_22-DX80tEcQ.jpg",At="/assets/item_23-C2ramuXH.jpg",qt="/assets/item_24-B3dTJIwG.jpg",zt="/assets/item_25-DPAhJq_6.jpg",be=[{id:1,y:40.8,x:51.4,lat:49.7597,lng:16.6647,title:"Moravská Třebová",description:"Domov L. V. Holzmaistera a sídlo muzea, kam zasílal své sbírky.",image:qt,region:"Europe",visitDate:"1885"},{id:2,y:47.3,x:55.5,lat:31.2001,lng:29.9187,title:"Egypt - Alexandrie",description:"Starověký přístav. Získání koptských textilií.",image:Lt,region:"North Africa",visitDate:"1891"},{id:3,y:47.3,x:56.9,lat:30.0444,lng:31.2357,title:"Egypt - Káhira",description:"Centrum obchodu na Blízkém východě. Nákup starožitností na trhu Chán al-Chalílí.",image:Et,region:"North Africa",visitDate:"1891"},{id:4,y:48.9,x:57.7,lat:29.9668,lng:32.5498,title:"Egypt - Suez",description:"Průjezd Suezským průplavem, klíčovým bodem cesty na východ.",image:Mt,region:"North Africa",visitDate:"1891"},{id:5,y:52,x:62,lat:12.8654,lng:45.0187,title:"Jemen - Aden",description:"Důležitá zastávka pro doplnění uhlí. Nákup aromatických pryskyřic.",image:wt,region:"Middle East",visitDate:"1891"},{id:6,y:54.2,x:70.1,lat:6.9271,lng:79.8612,title:"Srí Lanka - Kolombo",description:"Zastávka na cestě do Asie. Nákup drahokamů a tradičních masek.",image:gt,region:"South Asia",visitDate:"1891"},{id:7,y:56.9,x:75.6,lat:1.3521,lng:103.8198,title:"Singapur",description:"Křižovatka obchodních cest. Zde se Holzmaister setkal s obchodníky z celého světa.",image:yt,region:"South East Asia",visitDate:"1891"},{id:8,y:58.3,x:77.2,lat:-6.2088,lng:106.8456,title:"Indonésie - Batávie (Jakarta)",description:"Nizozemská východní Indie. Sběr krisů (tradičních dýk) a batikovaných látek.",image:ft,region:"South East Asia",visitDate:"1891"},{id:9,y:54.4,x:74.9,lat:13.7563,lng:100.5018,title:"Thajsko - Bangkok",description:"Království Siam. Návštěva chrámů a získání sošky Buddhy.",image:bt,region:"South East Asia",visitDate:"1892"},{id:10,y:51.7,x:68.2,lat:19.076,lng:72.8777,title:"Indie - Bombaj",description:"Vstupní brána do Indie. Fascinace rušnými trhy a architekturou viktoriánské gotiky.",image:pt,region:"South Asia",visitDate:"1892"},{id:11,y:48.9,x:68,lat:28.7041,lng:77.1025,title:"Indie - Dillí",description:"Návštěva Červené pevnosti a získání mogulskejch miniatur.",image:vt,region:"South Asia",visitDate:"1892"},{id:12,y:50.1,x:70.7,lat:25.3176,lng:82.9739,title:"Indie - Váránasí",description:"Posvátné město na Ganze. Pozorování rituálů a nákup rituálních nádob.",image:ht,region:"South Asia",visitDate:"1892"},{id:13,y:48.8,x:79.4,lat:31.2304,lng:121.4737,title:"Čína - Šanghaj",description:"Rušný přístav a brána do Číny. Sbírka obsahuje porcelánové vázy z dynastie Čching zakoupené na nábřeží Bund.",image:ut,region:"East Asia",visitDate:"1892"},{id:14,y:51.9,x:76.6,lat:22.3193,lng:114.1694,title:"Čína - Hongkong",description:"Britská kolonie v době návštěvy. Holzmaistera fascinovala směs východní a západní architektury.",image:mt,region:"East Asia",visitDate:"1892"},{id:15,y:47.2,x:78.3,lat:39.9042,lng:116.4074,title:"Čína - Peking",description:"Návštěva Zakázaného města. Získání tradičního hedvábného oděvu pro muzeum.",image:"https://images.unsplash.com/photo-1508804185872-d7badad00f7d?auto=format&fit=crop&q=80&w=800",region:"East Asia",visitDate:"1892"},{id:16,y:44.5,x:85.3,lat:35.4437,lng:139.638,title:"Japonsko - Jokohama",description:"Hlavní přístav, kterým Holzmaister připlul do Japonska. Zde zakoupil 'Japonské album' s ručně kolorovanými fotografiemi.",image:dt,region:"East Asia",visitDate:"1893"},{id:17,y:46.2,x:84.5,lat:35.6762,lng:139.6503,title:"Japonsko - Tokio",description:"Císařské město, kde Holzmaister strávil několik týdnů. Zde získal vzácné lakované krabičky a samurajské doplňky.",image:ct,region:"East Asia",visitDate:"1893"},{id:18,y:45.3,x:83.9,lat:35.0116,lng:135.7681,title:"Japonsko - Kjóto",description:"Starobylé hlavní město. Fotografie zachycuje chrám Kinkaku-dži, který Holzmaister navštívil během období kvetoucích sakur.",image:rt,region:"East Asia",visitDate:"1893"},{id:19,y:61.2,x:95.1,lat:-17.7134,lng:178.065,title:"Fidži",description:"Exotická zastávka v Pacifiku. Ukázky domorodého umění.",image:zt,region:"Oceania",visitDate:"1893"},{id:20,y:68.1,x:94.1,lat:-36.8485,lng:174.7633,title:"Nový Zéland - Auckland",description:"Setkání s Maorskou kulturou. Do sbírky přibyly řezby ze dřeva a nefritu.",image:St,region:"Oceania",visitDate:"1893"},{id:21,y:65.1,x:88.2,lat:-33.8688,lng:151.2093,title:"Austrálie - Sydney",description:"Přístavní město v Oceánii. Získání domorodých artefaktů a bumerangů.",image:xt,region:"Australia",visitDate:"1893"},{id:22,y:67.6,x:86.8,lat:-37.8136,lng:144.9631,title:"Austrálie - Melbourne",description:"Bohaté město díky zlaté horečce. Návštěva botanických zahrad.",image:kt,region:"Australia",visitDate:"1893"},{id:23,y:46.4,x:58.4,lat:31.7683,lng:35.2137,title:"Jeruzalém",description:"Svaté město. Získání upomínkových předmětů z olivového dřeva.",image:Dt,region:"Middle East",visitDate:"1894"},{id:24,y:45.1,x:58.7,lat:33.5138,lng:36.2765,title:"Damašek",description:"Jedno z nejstarších měst. Obdivování damašské oceli a látek.",image:Tt,region:"Middle East",visitDate:"1894"},{id:25,y:44.8,x:28.2,lat:40.7128,lng:-74.006,title:"New York",description:"Dlouhodobé působení Holzmaistera v USA, odkud podporoval muzeum.",image:At,region:"North America",visitDate:"1895-1920"}],Se="antigravity_gem_hints",Ee="antigravity_revealed_gems";function Ge(n=25){let r=Je();return(!r||Object.keys(r).length===0)&&(r=Yt(n),Ct(r)),r}function Yt(n){const r={},E=[1,2,3,4,5];return Array.from({length:n},(A,q)=>q+1).sort(()=>Math.random()-.5).slice(0,5).forEach((A,q)=>{r[A]=E[q]}),r}function Je(){try{const n=localStorage.getItem(Se);return n?JSON.parse(n):{}}catch(n){return console.error("Error loading gem hints:",n),{}}}function Ct(n){try{localStorage.setItem(Se,JSON.stringify(n))}catch(r){console.error("Error saving gem hints:",r)}}function It(n){return Je()[n]||null}function Ze(){try{const n=localStorage.getItem(Ee);return n?JSON.parse(n):[]}catch(n){return console.error("Error loading revealed gems:",n),[]}}function jt(n){try{localStorage.setItem(Ee,JSON.stringify(n))}catch(r){console.error("Error saving revealed gems:",r)}}function Pt(n,r){const E=Ze(),y=r.filter(g=>g.type===n).map(g=>g.id),d=[...new Set([...E,...y])];return jt(d),d}function We(n){return Ze().includes(n)}function Rt(){localStorage.removeItem(Se),localStorage.removeItem(Ee)}const ke=[{id:1,x:15.5,y:23.2,code:"TRA-1888",type:1,revealed:!1},{id:2,x:45.3,y:12.8,code:"TRA-3421",type:1,revealed:!1},{id:3,x:72.1,y:65.4,code:"TRA-5692",type:1,revealed:!1},{id:4,x:45.8,y:67.3,code:"MOR-2341",type:2,revealed:!1},{id:5,x:18.6,y:54.7,code:"MOR-7823",type:2,revealed:!1},{id:6,x:83.2,y:28.9,code:"MOR-4156",type:2,revealed:!1},{id:7,x:78.2,y:34.6,code:"JAP-5729",type:3,revealed:!1},{id:8,x:32.4,y:78.1,code:"JAP-9184",type:3,revealed:!1},{id:9,x:56.7,y:19.3,code:"JAP-2637",type:3,revealed:!1},{id:10,x:62.1,y:52.8,code:"IND-8432",type:4,revealed:!1},{id:11,x:24.8,y:38.5,code:"IND-1947",type:4,revealed:!1},{id:12,x:91.3,y:71.2,code:"IND-5281",type:4,revealed:!1},{id:13,x:88.7,y:71.4,code:"AUS-3156",type:5,revealed:!1},{id:14,x:12.9,y:58.6,code:"AUS-7429",type:5,revealed:!1},{id:15,x:67.5,y:43.9,code:"AUS-8163",type:5,revealed:!1}],Ke="/assets/gem_01-CZMZIHlm.png",Ve="/assets/gem_02-Bp-ud6f4.png",Ue="/assets/gem_03-DfWzPX7L.png",Qe="/assets/gem_04-C8DOo_w2.png",et="/assets/gem_05-Be9G19XQ.png",_t={1:Ke,2:Ve,3:Ue,4:Qe,5:et};let W=null;function Ht(n,r,E=[],y=null){de();const d=document.createElement("div");d.classList.add("modal-overlay");const g=E.findIndex(p=>p.id===n.id),A=(g-1+E.length)%E.length,q=(g+1)%E.length,D=It(n.id);let X="";if(D){const p=ke.some($=>$.type===D&&We($.id)),b=p?"Gems Revealed!":"Unhide Gems on Map",z=p?"gem-reveal-btn disabled":"gem-reveal-btn",x=p?"disabled":"";X=`
        <div class="gem-hint-bar">
            <div class="gem-hint-content">
                <img src="${_t[D]}" alt="Gem Hint" class="gem-hint-icon">
                <div class="gem-hint-text">
                    <strong>Hidden Gem Detected!</strong>
                    <span>This location holds a clue to finding rare crystals.</span>
                </div>
                <button class="${z}" data-gem-type="${D}" ${x}>
                    ${b}
                </button>
            </div>
        </div>
      `}d.innerHTML=`
    <div class="modal-content">
      <div class="modal-image-container">
        ${X}
        <img src="${n.image}" alt="${n.title}" class="modal-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
        <div class="modal-image-placeholder" style="display: none;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#444" stroke-width="1">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
            </svg>
            <span>Chybí fotografie</span>
        </div>
        <div class="modal-region-tag">${n.region}</div>
      </div>
      <div class="modal-info">
        <button class="close-button">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <div class="modal-location-label">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
            LOKACE Č. ${n.id}
        </div>
        <h2 class="modal-title">${n.title}</h2>
        ${n.visitDate?`<div class="modal-visit-date">Navštíveno: ${n.visitDate}</div>`:""}
        <div class="modal-divider"></div>
        <p class="modal-description">${n.description}</p>
        
        <div class="modal-nav-buttons">
            <button class="nav-btn prev-btn">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                Předchozí
            </button>
            <button class="nav-btn next-btn">
                Další
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
        </div>

        <div class="modal-footer">Sbírka L. V. Holzmaistera</div>
      </div>
    </div>
    `,r.appendChild(d),requestAnimationFrame(()=>{d.classList.add("active")}),d.querySelector(".close-button").addEventListener("click",de),d.addEventListener("click",p=>{p.target===d&&de()});const L=d.querySelector(".gem-reveal-btn");L&&!L.classList.contains("disabled")&&L.addEventListener("click",p=>{p.stopPropagation();const b=parseInt(L.dataset.gemType);Pt(b,ke),L.textContent="Gems Revealed!",L.classList.add("disabled"),L.disabled=!0,window.dispatchEvent(new CustomEvent("gemRevealed",{detail:{gemType:b}}))}),y&&(d.querySelector(".prev-btn").addEventListener("click",()=>{d.classList.remove("active"),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d),W=null,y(A)},3e3)}),d.querySelector(".next-btn").addEventListener("click",()=>{d.classList.remove("active"),setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d),W=null,y(q)},3e3)})),W=d}function de(){if(W){const n=W;n.classList.remove("active"),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},3e3),W=null}}const Xt="/assets/start_jorney-B-vkNHQ0.png",Bt="/assets/start_button-C0gmB8GR.png";class $t{constructor(r){this.onStart=r,this.overlay=null,this.init()}init(){this.overlay=document.createElement("div"),this.overlay.classList.add("idle-screen-overlay"),this.overlay.innerHTML=`
            <div class="start-game-container">
                <img src="${Xt}" class="start-game-bg" alt="Start Journey">
                <button class="start-game-btn">
                    <img src="${Bt}" alt="Start Game">
                </button>
            </div>
        `,this.overlay.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 999999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        `,document.body.appendChild(this.overlay);const r=this.overlay.querySelector(".start-game-btn");r&&r.addEventListener("click",E=>{E.stopPropagation(),this.hide(),this.onStart&&this.onStart()})}show(){this.overlay&&(console.log("Showing Start Page"),this.overlay.style.opacity="1",this.overlay.style.pointerEvents="auto",setTimeout(()=>{window.dispatchEvent(new CustomEvent("gameReset"))},100))}hide(){this.overlay&&(console.log("Hiding Start Page"),this.overlay.style.opacity="0",this.overlay.style.pointerEvents="none")}}let Fe,Ne;const Gt=6e4,Ft=12e4;let me=null;function Nt(){console.log("=== IDLE TIMER INIT START ==="),me=new $t(()=>{console.log("Start Game clicked - starting idle tracking"),Ot()}),console.log("Initializing IdleTimer - Showing Start Page"),requestAnimationFrame(()=>{me.show(),setTimeout(()=>{window.dispatchEvent(new CustomEvent("gameReset"))},100)}),console.log("=== IDLE TIMER INIT END ===")}function Ot(){console.log("Starting idle tracking..."),P(),["mousedown","mousemove","keypress","scroll","touchstart","click"].forEach(r=>{document.addEventListener(r,P,{passive:!0})})}function P(){clearTimeout(Fe),clearTimeout(Ne),Ne=setTimeout(Jt,Gt),Fe=setTimeout(Zt,Ft)}function Jt(){console.log("1 minute idle - resetting zoom..."),window.dispatchEvent(new CustomEvent("zoomReset"))}function Zt(){console.log("2 minutes idle - showing Start Game page..."),de(),me&&me.show(),window.dispatchEvent(new CustomEvent("gameReset"))}let ue=null;function Wt(n,r,E){xe();const y=document.createElement("div");y.classList.add("gem-modal-overlay");const d=E;y.innerHTML=`
        <div class="gem-modal-content">
            <div class="gem-modal-icon">
                <img src="${d}" alt="Gem" style="width: 80px; height: 80px; object-fit: contain;">
            </div>
            <h2 class="gem-modal-title">Hidden Artifact Found!</h2>
            <p class="gem-modal-subtitle">You have discovered a secret location.</p>
            <div class="gem-modal-code-label">SECRET CODE</div>
            <div class="gem-modal-code">${n.code}</div>
            <button class="gem-modal-close">Close</button>
        </div>
    `,r.appendChild(y),requestAnimationFrame(()=>{y.classList.add("active")}),y.querySelector(".gem-modal-close").addEventListener("click",xe),y.addEventListener("click",A=>{A.target===y&&xe()}),ue=y}function xe(){if(ue){const n=ue;n.classList.remove("active"),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},500),ue=null}}const Kt="/assets/16k_aa-DcSpPsL4.jpg",Vt="/assets/16k_ab-no00rKNZ.jpg",Ut="/assets/16k_ba-CcfPJy1z.jpg",Qt="/assets/16k_bb-DPfEk5Xw.jpg",en="/assets/WorldMap_bg_1k-D8ZTdbID.jpg",Oe={1:Ke,2:Ve,3:Ue,4:Qe,5:et};function tn(n,r){let E=1,y=0,d=0,g=!1,A=!1,q=null,D=[...be],X=[...ke],B=!1,L={x:0,y:0},p=0,b=0,z=1,x=1,$=.5,U=!1,Le=0,Me=0,we=0,ge=0;Ge(be.length);const u=document.createElement("div");u.classList.add("map-content-wrapper"),n.appendChild(u);const pe=document.createElement("div");pe.classList.add("map-background-container");const ve=[{src:Kt,position:"top-left",element:null},{src:Vt,position:"top-right",element:null},{src:Ut,position:"bottom-left",element:null},{src:Qt,position:"bottom-right",element:null}],Q=document.createElement("div");Q.classList.add("tiles-16k-container"),Q.style.cssText=`
        position: relative;
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        z-index: 1;
    `,ve.forEach(e=>{const t=document.createElement("img");t.src=e.src,t.style.cssText="width: 100%; height: auto; display: block; object-fit: cover;",t.ondragstart=i=>i.preventDefault(),Q.appendChild(t),e.element=t}),pe.appendChild(Q),u.appendChild(pe);function De(){const e=n.getBoundingClientRect(),t=e.width/2,i=e.height/2,o=(t-R)/w,c=(i-_)/w,a=u.offsetWidth,m=u.offsetHeight,h=o/a*100,T=c/m*100;let C="";return T<50?C=h<50?"16k_aa.jpg":"16k_ab.jpg":C=h<50?"16k_ba.jpg":"16k_bb.jpg",C}let w=1,R=0,_=0,l=1,k=0,S=0;const J=16;let ee=null,Te;const tt=6e4;function G(){clearTimeout(Te),Te=setTimeout(()=>{l=te(),k=0,S=0,Y()},tt)}G();function te(){const e=n.offsetWidth,t=n.offsetHeight;u.offsetWidth;const i=u.offsetHeight||t;return i===0?1:Math.max(1,t/i)}let he=null;function Ae(e,t=!0){if(e<0||e>=D.length)return;const i=D[e];u.querySelectorAll(".map-point").forEach(f=>f.classList.remove("active"));const c=u.querySelector(`.map-point[data-id="${i.id}"]`);c&&c.classList.add("active");const a=n.getBoundingClientRect(),m=a.width/2,h=a.height/2,T=u.offsetWidth,C=u.offsetHeight,I=i.x/100*T,j=i.y/100*C;if(t){let f=l*2;f<2&&(f=2),f>J&&(f=J),l=f,he=f}else he&&(l=he);k=m-I*l,S=h-j*l,Y(),ee=()=>{Ht(i,r,D,f=>{Ae(f,!1)}),P(),G()}}function ne(){u.querySelectorAll(".map-point").forEach(t=>t.remove()),D.forEach((t,i)=>{const o=document.createElement("div");o.classList.add("map-point"),g&&o.classList.add("draggable"),o.style.left=`${t.x}%`,o.style.top=`${t.y}%`,o.dataset.id=t.id;const c=document.createElement("div");c.classList.add("map-point-label"),c.textContent=t.title,o.appendChild(c);const a=m=>{g||(m.stopPropagation(),P(),G(),Ae(i))};o.addEventListener("click",a),o.addEventListener("touchstart",m=>{g||a(m)},{passive:!0}),o.addEventListener("mousedown",m=>{g&&(m.stopPropagation(),A=!0,q=t.id,o.classList.add("dragging"))}),u.appendChild(o)})}ne();function fe(){u.querySelectorAll(".gem-point").forEach(t=>t.remove()),X.forEach(t=>{const i=document.createElement("div");i.classList.add("gem-point"),i.style.left=`${t.x}%`,i.style.top=`${t.y}%`,i.dataset.id=t.id;const o=t.type||t.id%5+1;i.style.backgroundImage=`url('${Oe[o]}')`,i.addEventListener("click",c=>{g||B||(c.stopPropagation(),Wt(t,r,Oe[o]),P(),G())}),u.appendChild(i)}),ye()}function ye(){u.querySelectorAll(".gem-point").forEach(t=>{const i=parseInt(t.dataset.id),o=We(i);w>=8||o?(t.classList.add("visible"),o&&w<8?t.classList.add("revealed-low-zoom"):t.classList.remove("revealed-low-zoom")):(t.classList.remove("visible"),t.classList.remove("revealed-low-zoom"))})}window.addEventListener("gemRevealed",()=>{ye()}),window.addEventListener("zoomReset",()=>{console.log("Zoom resetting to initial view..."),l=te(),k=0,S=0,Y()}),window.addEventListener("gameReset",()=>{console.log("Game Resetting..."),Rt();const e=[];for(let i=1;i<=5;i++)for(let o=0;o<3;o++)e.push(i);for(let i=e.length-1;i>0;i--){const o=Math.floor(Math.random()*(i+1));[e[i],e[o]]=[e[o],e[i]]}X.forEach((i,o)=>{o<e.length&&(i.type=e[o])}),Ge(be.length),fe(),l=te(),k=0,S=0,Y()}),fe();function Y(){const e=n.offsetWidth,t=n.offsetHeight,i=u.offsetWidth,o=u.offsetHeight,c=te();l<c&&(l=c),l>J&&(l=J);const a=0,m=e-i*l,h=0,T=t-o*l;k=Math.min(Math.max(k,m),a),S=Math.min(Math.max(S,T),h)}function nt(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}const it=.05;let H=null,F={version:"...",prompts:0,timeSpentMinutes:0};async function ot(){try{F=await(await fetch("/production.json")).json(),ze(De())}catch(e){console.error("Failed to load production data",e)}}function qe(e){const t=Math.floor(e/60),i=e%60;return`${t}h ${i}m`}function st(){H=document.createElement("div"),H.classList.add("debug-panel"),H.innerHTML=`
            <div class="debug-version">v${F.version} | P: ${F.prompts} | T: ${qe(F.timeSpentMinutes)}</div>
            <div class="debug-date">${new Date().toLocaleDateString("cs-CZ")}</div>
            <div class="debug-bg">BG: <span class="debug-bg-name">...</span></div>
            <div class="debug-zoom">Zoom: <span class="debug-zoom-value">1.00x</span></div>
            <div class="debug-coords">X: <span class="debug-x">0</span>% Y: <span class="debug-y">0</span>%</div>
        `,document.body.appendChild(H)}function ze(e){if(!H)return;const t=H.querySelector(".debug-version"),i=H.querySelector(".debug-bg-name"),o=H.querySelector(".debug-zoom-value"),c=H.querySelector(".debug-x"),a=H.querySelector(".debug-y");t&&(t.textContent=`v${F.version} | P: ${F.prompts} | T: ${qe(F.timeSpentMinutes)}`),i&&(i.textContent=e),o&&(o.textContent=`${w.toFixed(2)}x`),c&&(c.textContent=L.x.toFixed(1)),a&&(a.textContent=L.y.toFixed(1))}st(),ot();function Ye(){const e=Math.abs(k-R),t=Math.abs(S-_),i=Math.abs(l-w),o=Math.sqrt(e*e+t*t)+i*100,a=Math.min(o/1e3,1),m=nt(1-a),h=it+m*.05;R+=(k-R)*h,_+=(S-_)*h,w+=(l-w)*h,Math.abs(k-R)<.5&&Math.abs(S-_)<.5&&Math.abs(l-w)<.005&&(R=k,_=S,w=l,ee&&(ee(),ee=null)),u.style.transform=`translate(${R}px, ${_}px) scale(${w})`;const C=De();ze(C),ye(),E=w,y=R,d=_,requestAnimationFrame(Ye)}requestAnimationFrame(Ye),n.addEventListener("wheel",e=>{e.preventDefault(),P(),G();const t=n.getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top,c=(i-k)/l,a=(o-S)/l,m=-e.deltaY,h=1.2;m>0?l*=h:l/=h,Y(),k=i-c*l,S=o-a*l,Y()},{passive:!1}),n.addEventListener("dblclick",e=>{e.preventDefault(),P(),G();const t=n.getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top;let a=l*2;a>J&&(a=J);const m=t.width/2,h=t.height/2,T=(i-k)/l,C=(o-S)/l;l=a,k=m-T*l,S=h-C*l,Y()});let Z=!1,N=0,O=0,ie=null,Ce=1;function Ie(e){const t=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.hypot(t,i)}function je(e){const t=(e[0].clientX+e[1].clientX)/2,i=(e[0].clientY+e[1].clientY)/2;return{x:t,y:i}}function Pe(e){if(!(g&&A))if(P(),G(),e.touches){if(e.touches.length===1)Z=!0,N=e.touches[0].clientX,O=e.touches[0].clientY,n.style.cursor="grabbing";else if(e.touches.length===2){Z=!1,ie=Ie(e.touches),Ce=l;const t=je(e.touches);N=t.x,O=t.y}}else Z=!0,N=e.clientX,O=e.clientY,n.style.cursor="grabbing"}function Re(e){P(),G();const t=e.clientX||(e.touches?e.touches[0].clientX:0),i=e.clientY||(e.touches?e.touches[0].clientY:0),o=n.getBoundingClientRect(),c=t-o.left,a=i-o.top,m=(c-R)/w,h=(a-_)/w,T=u.offsetWidth,C=u.offsetHeight;if(L.x=m/T*100,L.y=h/C*100,g&&A&&q){e.preventDefault();let I=L.x,j=L.y;I=Math.max(0,Math.min(100,I)),j=Math.max(0,Math.min(100,j));const f=u.querySelector(`.map-point[data-id="${q}"]`);f&&(f.style.left=`${I}%`,f.style.top=`${j}%`);const V=D.findIndex(lt=>lt.id===q);V!==-1&&(D[V].x=Math.round(I*10)/10,D[V].y=Math.round(j*10)/10);const re=s.querySelector(".coord-x"),$e=s.querySelector(".coord-y");re&&$e&&(re.textContent=I.toFixed(1),$e.textContent=j.toFixed(1));return}if(e.touches&&e.touches.length===2){e.preventDefault();const I=Ie(e.touches);if(ie){const j=I/ie;l=Ce*j;const f=je(e.touches),V=f.x-N,re=f.y-O;k+=V,S+=re,N=f.x,O=f.y,Y()}}else if(Z){e.preventDefault();const I=t-N,j=i-O;k+=I,S+=j,N=t,O=i,Y()}}function _e(e){if(B&&!Z){if(e.clientX||e.changedTouches&&e.changedTouches[0].clientX,e.clientY||e.changedTouches&&e.changedTouches[0].clientY,e.target.closest(".edit-mode-ui")||e.target.closest(".map-point"))return;const t={id:X.length+1,x:Math.round(L.x*10)/10,y:Math.round(L.y*10)/10,code:at()};X.push(t),fe();return}if(Z=!1,ie=null,n.style.cursor="default",A){A=!1;const t=u.querySelector(`.map-point[data-id="${q}"]`);t&&t.classList.remove("dragging"),q=null}}function at(){const e=["TRA","MOR","JAP","IND","AUS","EGY","CHN"],t=e[Math.floor(Math.random()*e.length)],i=Math.floor(Math.random()*9e3)+1e3;return`${t}-${i}`}n.addEventListener("mousedown",Pe),n.addEventListener("touchstart",Pe,{passive:!1}),window.addEventListener("mousemove",Re),window.addEventListener("touchmove",Re,{passive:!1}),window.addEventListener("mouseup",_e),window.addEventListener("touchend",_e),window.addEventListener("resize",()=>{Y()}),ve[0].element&&(ve[0].element.onload=()=>{Y(),R=k,_=S,w=l});const K=document.createElement("div");K.classList.add("admin-trigger"),K.innerHTML=`
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
        </svg>
    `,K.title="Edit Mode",document.body.appendChild(K);const v=document.createElement("div");v.classList.add("reference-overlay"),v.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('${en}');
        background-size: cover;
        z-index: 10;
        opacity: 0;
        pointer-events: none;
        display: none;
    `,u.insertBefore(v,u.firstChild);const oe=document.createElement("div");oe.classList.add("ref-handle","ref-handle-top"),oe.innerHTML='<div class="handle-line"></div>',v.appendChild(oe);const se=document.createElement("div");se.classList.add("ref-handle","ref-handle-bottom"),se.innerHTML='<div class="handle-line"></div>',v.appendChild(se),v.addEventListener("mousedown",e=>{!g||!v.classList.contains("active")||e.target.closest(".ref-handle")||(U=!0,Le=e.clientX,Me=e.clientY,we=p,ge=b,v.style.cursor="grabbing",e.stopPropagation())}),window.addEventListener("mousemove",e=>{if(U){const t=e.clientX-Le,i=e.clientY-Me;p=we+t,b=ge+i,s.querySelector(".input-ref-x").value=p.toFixed(1),s.querySelector(".input-ref-y").value=b.toFixed(1),M()}}),window.addEventListener("mouseup",()=>{U&&(U=!1,v.style.cursor="grab")});let ae=!1,le=null,He=0,ce=1;function Xe(e,t){!g||!v.classList.contains("active")||(ae=!0,le=t,He=e.clientY,ce=x,e.stopPropagation(),e.preventDefault())}oe.addEventListener("mousedown",e=>Xe(e,"top")),se.addEventListener("mousedown",e=>Xe(e,"bottom")),window.addEventListener("mousemove",e=>{if(ae){const i=(e.clientY-He)/500;if(le==="top"){x=Math.max(.1,Math.min(3,ce-i));const o=n.offsetHeight;b=ge+(ce-x)*o}else le==="bottom"&&(x=Math.max(.1,Math.min(3,ce+i)));s.querySelector(".input-ref-scaley").value=x.toFixed(2),s.querySelector(".input-ref-y").value=b.toFixed(1),M()}}),window.addEventListener("mouseup",()=>{ae&&(ae=!1,le=null)});const s=document.createElement("div");s.classList.add("edit-mode-ui"),s.innerHTML=`
        <button class="btn-close-edit">X</button>
        <div class="edit-mode-indicator">EDIT MODE ACTIVE</div>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <button class="btn-toggle-ref">Toggle Reference Map</button>
            <button class="btn-toggle-gems">Add Gems Mode</button>
            <button class="btn-submit">Save Locations</button>
            <button class="btn-save-gems">Save Gems</button>
        </div>
        
        <div class="ref-controls-panel">
            <div class="ref-controls-title">Reference Map Controls</div>
            
            <div class="control-group">
                <label>Position X:</label>
                <button class="btn-adjust" data-action="x-minus">-</button>
                <input type="number" class="input-ref-x" value="0" step="0.1">
                <button class="btn-adjust" data-action="x-plus">+</button>
            </div>
            
            <div class="control-group">
                <label>Position Y:</label>
                <button class="btn-adjust" data-action="y-minus">-</button>
                <input type="number" class="input-ref-y" value="0" step="0.1">
                <button class="btn-adjust" data-action="y-plus">+</button>
            </div>
            
            <div class="control-group">
                <label>Scale X:</label>
                <button class="btn-adjust" data-action="scalex-minus">-</button>
                <input type="number" class="input-ref-scalex" value="1.0" step="0.01" min="0.1" max="3">
                <button class="btn-adjust" data-action="scalex-plus">+</button>
            </div>
            
            <div class="control-group">
                <label>Scale Y:</label>
                <button class="btn-adjust" data-action="scaley-minus">-</button>
                <input type="number" class="input-ref-scaley" value="1.0" step="0.01" min="0.1" max="3">
                <button class="btn-adjust" data-action="scaley-plus">+</button>
            </div>
            
            <div class="control-group">
                <label>Opacity:</label>
                <input type="range" class="input-ref-opacity" min="0" max="1" step="0.05" value="0.5">
                <span class="opacity-value">0.5</span>
            </div>
            
            <div class="control-group">
                <button class="btn-reset-ref">Reset Reference Map</button>
            </div>
            
            <div class="control-group">
                <button class="btn-auto-position">Auto-Position All Points</button>
            </div>
            
            <div class="coordinate-display">
                <div>Mouse: <span class="coord-x">--</span>%, <span class="coord-y">--</span>%</div>
            </div>
        </div>
    `,document.body.appendChild(s);const Be=e=>{g=e,g?(s.classList.add("active"),ne()):(s.classList.remove("active"),v.classList.remove("active"),ne())};K.addEventListener("click",()=>Be(!0)),s.querySelector(".btn-close-edit").addEventListener("click",()=>Be(!1)),s.querySelector(".btn-toggle-ref").addEventListener("click",()=>{v.classList.toggle("active"),v.classList.contains("active")?(v.style.display="block",v.style.pointerEvents="auto",v.style.opacity=$):(v.style.display="none",v.style.pointerEvents="none",v.style.opacity=0)}),s.querySelector(".btn-toggle-gems").addEventListener("click",e=>{B=!B,e.target.textContent=B?"Stop Adding Gems":"Add Gems Mode",e.target.style.backgroundColor=B?"#FF6B6B":"",n.style.cursor=B?"crosshair":"default"}),s.querySelector(".btn-submit").addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(D,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","locations.json"),document.body.appendChild(t),t.click(),t.remove()}),s.querySelector(".btn-save-gems").addEventListener("click",()=>{const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(X,null,2)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","gems.json"),document.body.appendChild(t),t.click(),t.remove()});function M(){v.style.transform=`translate(${p}px, ${b}px) scale(${z}, ${x})`,v.style.opacity=$}s.querySelector('[data-action="x-minus"]').addEventListener("click",()=>{p-=.1,s.querySelector(".input-ref-x").value=p.toFixed(1),M()}),s.querySelector('[data-action="x-plus"]').addEventListener("click",()=>{p+=.1,s.querySelector(".input-ref-x").value=p.toFixed(1),M()}),s.querySelector(".input-ref-x").addEventListener("input",e=>{p=parseFloat(e.target.value)||0,M()}),s.querySelector('[data-action="y-minus"]').addEventListener("click",()=>{b-=.1,s.querySelector(".input-ref-y").value=b.toFixed(1),M()}),s.querySelector('[data-action="y-plus"]').addEventListener("click",()=>{b+=.1,s.querySelector(".input-ref-y").value=b.toFixed(1),M()}),s.querySelector(".input-ref-y").addEventListener("input",e=>{b=parseFloat(e.target.value)||0,M()}),s.querySelector('[data-action="scalex-minus"]').addEventListener("click",()=>{z=Math.max(.1,z-.01),s.querySelector(".input-ref-scalex").value=z.toFixed(2),M()}),s.querySelector('[data-action="scalex-plus"]').addEventListener("click",()=>{z=Math.min(3,z+.01),s.querySelector(".input-ref-scalex").value=z.toFixed(2),M()}),s.querySelector(".input-ref-scalex").addEventListener("input",e=>{z=parseFloat(e.target.value)||1,M()}),s.querySelector('[data-action="scaley-minus"]').addEventListener("click",()=>{x=Math.max(.1,x-.01),s.querySelector(".input-ref-scaley").value=x.toFixed(2),M()}),s.querySelector('[data-action="scaley-plus"]').addEventListener("click",()=>{x=Math.min(3,x+.01),s.querySelector(".input-ref-scaley").value=x.toFixed(2),M()}),s.querySelector(".input-ref-scaley").addEventListener("input",e=>{x=parseFloat(e.target.value)||1,M()}),s.querySelector(".input-ref-opacity").addEventListener("input",e=>{$=parseFloat(e.target.value),s.querySelector(".opacity-value").textContent=$.toFixed(2),M()}),s.querySelector(".btn-reset-ref").addEventListener("click",()=>{p=0,b=0,z=1,x=1,$=.5,s.querySelector(".input-ref-x").value=0,s.querySelector(".input-ref-y").value=0,s.querySelector(".input-ref-scalex").value=1,s.querySelector(".input-ref-scaley").value=1,s.querySelector(".input-ref-opacity").value=.5,s.querySelector(".opacity-value").textContent="0.50",M()}),n.addEventListener("mousemove",e=>{if(!g)return;const t=n.getBoundingClientRect(),i=e.clientX-t.left-y,o=e.clientY-t.top-d;let c=i/(t.width*E)*100,a=o/(t.height*E)*100;c=Math.max(0,Math.min(100,c)),a=Math.max(0,Math.min(100,a)),s.querySelector(".coord-x").textContent=c.toFixed(1),s.querySelector(".coord-y").textContent=a.toFixed(1)}),s.querySelector(".btn-auto-position").addEventListener("click",()=>{function e(o,c){const a=(c+180)/360*100,m=o*Math.PI/180,T=(1-Math.log(Math.tan(Math.PI/4+m/2))/Math.PI)*50;return{x:a,y:T}}const t=u.offsetWidth,i=u.offsetHeight;D.forEach(o=>{if(o.lat!==void 0&&o.lng!==void 0){const c=e(o.lat,o.lng);let a=c.x/100*t,m=c.y/100*i;a=a*z,m=m*x,a=a+p,m=m+b;const h=a/t*100,T=m/i*100;o.x=Math.round(h*10)/10,o.y=Math.round(T*10)/10}}),ne(),alert("All points have been auto-positioned based on their geographic coordinates and the current reference map alignment!")}),document.addEventListener("click",P),document.addEventListener("touchstart",P,{passive:!0})}document.addEventListener("DOMContentLoaded",()=>{const n=document.querySelector("#app");n&&(n.innerHTML=`
      <div class="kiosk-container">
        <div id="map-container"></div>
        <div id="modal-container"></div>
      </div>
    `,tn(document.querySelector("#map-container"),document.querySelector("#modal-container")),Nt())});
